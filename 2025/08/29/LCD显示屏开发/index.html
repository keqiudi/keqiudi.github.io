<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>LCD显示屏开发 | THEDI的仓库</title><meta name="keywords" content="LCD"><meta name="author" content="THEDI"><meta name="copyright" content="THEDI"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="LCD显示屏开发"><meta name="application-name" content="LCD显示屏开发"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="LCD显示屏开发"><meta property="og:url" content="https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/index.html"><meta property="og:site_name" content="THEDI的仓库"><meta property="og:description" content="LCD显示屏开发"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://www.thekqd.top/assets/213.webp"><meta property="article:author" content="THEDI"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.thekqd.top/assets/213.webp"><meta name="description" content="LCD显示屏开发"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"/><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css#fontawesome_animation 如果有就会加载，示例值：https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与大家一起进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"该回来学习啦！","backTitle":"w(ﾟДﾟ)w快认真学习！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🏠 智能家居小能手"]},
  algolia: {"appId":"PW49GHYJ6T","apiKey":"42b04be58e36cfebeb6ac1989c6e8009","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: THEDI","link":"链接: ","source":"来源: THEDI的仓库","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'THEDI的仓库',
  title: 'LCD显示屏开发',
  postAI: '',
  pageFillDescription: 'LCD显示屏介绍, 什么是LCD?, LCD基本结构, LCD显示原理, 常见屏幕型号, 字符型LCD（Character LCD）, 段码屏（Segment LCD）, 图形点阵LCD（Graphic LCD）, TFT彩色LCD（TFT LCD）, IPS宽视角LCD（IPS LCD）, OLED显示屏(非LCD), 主要区别总结, LCD开发手册解读, 厂家代码, 屏幕手册, 总体描述, 引脚描述, 电气特性, ST7789, ST7789介绍, 手册阅读, 特征介绍, 全引脚介绍, 通信接口, 通信引脚定义, RDX、WRX、DCX说明, 写命令, 数据格式, 时序, 读数据, LCD显示开发时相关知识, LCD背光源(Back Light), 背光层介绍, 背光引脚, 背光引脚的使用, 硬件PWM调光, 调光介绍, 使用PWM注意事项, 背光引脚代码, 引脚配置, 驱动代码, LCD像素格式, 像素格式介绍, LCD使用, LCD初始化代码, 为什么要有这个LCD初始化代码？, 初始化代码示例, 从零开始开发显示驱动, 如何入手开发LCD, 常用命令, LCD底层开发, 前言, 头文件, 引脚初始化, 通讯协议写数据, 芯片写命令x2F数据, LCD初始化, LCD设置显示窗口(行列地址), 显示流程, 列地址, 行地址, 写显存, 对应代码, 低功耗相关, 其他补充, 源文件, LCD显示开发, 前言, 头文件, 背光, LCD显示开发, 填充区域, 画图形, 显示字符x2F数字等, 显示图像, 源文件, 驱动测试代码编写, 填充测试, 其他测试, LCD开发时可能的问题, 花屏显示屏介绍什么是液晶显示屏是一种利用液晶材料的光电效应实现显示内容的平面显示设备广泛应用于嵌入式系统如智能家居工业控制手持设备等基本结构主要由以下几部分组成液晶层夹在两片玻璃基板之间负责成像偏光片用于控制光线的通过与偏振电极层通过电信号控制液晶分子的排列驱动电路实现信号传递控制显示内容背光源提供照明使显示内容可见显示原理的显示原理是通过控制液晶分子的排列方式改变光线的透射与反射从而实现不同的显示效果常见的显示方式有静态驱动每个像素单独控制适用于小尺寸动态驱动通过扫描方式控制行列适用于大尺寸常见屏幕型号字符型特点只能显示固定字符如字母数字部分支持自定义简易符号常见型号列行列行等接口并口部分带扩展板用途仪表家电简单菜单等段码屏特点只能显示预设的数字符号或图案如电子秤万年历的数字段常见型号段段定制段码等接口并口直接控制每个段用途时钟电子秤遥控器家电面板等图形点阵特点支持显示任意点阵图形汉字图片等常见型号点点等接口并口用途工业仪表便携设备复杂菜单简易图形显示彩色特点全彩显示高分辨率支持图片动画复杂常见型号等接口并口等用途智能穿戴手持终端车载中控消费电子宽视角特点的改进型色彩更好可视角更大响应更快常见型号与同通常会注明用途智能终端高端显示界面显示屏非特点自发光无需背光厚度薄对比度高功耗低常见型号等接口用途智能手表便携设备低功耗场景主要区别总结类型显示内容色彩代表型号典型接口主要用途字符型字符单色并口仪表菜单段码屏数字符号单色段段定制并口家电计时器点阵图形文字单色并口工业定制图形图形图片动画全彩等并口动画终端图形图片动画全彩系列并口等高清显示非图形文字单彩等便携低功耗开发手册解读这里主要是记录我拿到一块屏幕该如何看手册不至于一脸懵还有就是驱动时的一些思路是为了学习开发驱动的过程和加快开发速度厂家代码在实操使用情况都是先跟屏幕厂家拿初始化时序不同屏幕先拿到厂家提供时序代码再来修改使用一般厂家会提供自己瞎试很费劲如果时序不对驱动起来屏幕会花屏一般厂家会给我们初始化代码和驱动代码我们一般不进行全部从零开始开发这个涉及到底层驱动的实现一般很麻烦我们实际开发产品的时候都是对厂家提供的驱动例程等进行移植修改除非是芯片冷门没有驱动或有特殊性能优化需求的时候原因主要如下驱动代码重复性很高且容易出错厂家模块商往往会提供参考驱动移植包甚至库兼容的驱动屏幕手册我们这里使用触摸屏首先先对一定是屏幕的手册进行了解具体分为以下几个方面总体描述手册先看总体描述了解屏幕开发时比较关键的参数分辨率驱动芯片通信接口其余的看看就即可分辨率驱动芯片通信接口特性线并行接口方便与主控芯片连接应用场景设备移动支付终端个人导航设备其他需要高质量显示的设备全介绍项目规格单位说明备注说明屏幕尺寸英寸对角线常用于小型嵌入式设备像素数量像素横向纵向三色子像素显示区域毫米实际可视的显示区域像素间距毫米每个像素的物理间隔外形尺寸毫米屏幕整体外壳尺寸像素排列竖条每像素按红绿蓝竖条排列显示模式默认状态为黑色底视角全视角任意方向都能清晰看到灰度反转方向无特殊灰度反转显示色彩位色深约万种颜色亮度屏幕亮度适合室内外使用对比度显示黑白对比效果表面处理未特别说明接口类型线串行接口常见于嵌入式主控与通信背光类型侧入式灯从侧面照明驱动芯片负责与主控通信及驱动显示工作温度适用环境温度范围存储温度存储时允许的温度范围重量未标注引脚描述然后是看引脚描述一定要确定各个引脚功能开发才能有大体思路最后把哪些引脚属于哪部分相关的给分类显示驱动芯片相关接口数据命令选择片选信号时钟信号数据输入输出引脚外部复位信号触摸芯片相关接口触摸时钟信号触摸数据信号触摸复位信号触摸中断信号屏幕英文手册中文翻译引脚引脚代表是发送命令代表发送数据电气特性手册上这部分主要是进行硬件设计时需要关心的软件暂时不用管介绍是一款常用于小尺寸屏的显示驱动芯片它集成了显示控制器和驱动器支持多种显示接口通常为或并口为嵌入式设备如手表智能穿戴工业仪表等提供图像显示解决方案通过或并行接口与主控芯片通信能够驱动或接口的屏幕特性支持分辨率支持常见的分辨率如等内置显存芯片内部集成显示缓冲区方便主控刷新显示内容通信接口支持并口接口部分型号支持显示模式支持位和位颜色深度可配置显示方向横屏竖屏电源管理内部集成电源电路支持低功耗模式适合电池供电的设备命令集丰富提供寄存器配置命令可自定义显示区域色彩格式背光控制等手册阅读尽可能地只阅读我们需要的部分减少耗时下方的介绍顺序也是以后开发时推荐阅读手册的顺序特征介绍首先直接看一下特征介绍大致看一下分辨率通信接口等等全引脚介绍第六章是所有的引脚功能介绍随便看看即可是在要看只需要关注通信相关引脚模式引脚等通信接口我们之前在手册第二章特征描述中看到了支持的通信接口如下接口类型说明系列接口并口支持位位位位数据位宽适用于高速数据传输接口位包含等信号适合高分辨率彩色显示线串行接口即便于少管脚连接及嵌入式应用接口专用同步信号接口用于显示刷新同步然后就是找对我们关心的串行接口通信相关部分我们可以看到第章就对各个接口等功能进行详细描述主要就是告诉我们该如何发送指令数据等我们屏幕使用的是四线所以只关注四线即可主要看四线的引脚定义如何写命令数据等通信引脚定义通过电平决定芯片属于哪种接口模式其中圈起来的是相关的模式对于该屏幕上说的是线模式对应原理上的连接如图也对应线的模式所以我们就该去了解相关内容主要是各个功能进行了解的串行接口主要有四种引脚定义三线串行接口四线串行接口原文这部分说的是串行接口有线位或线位双向接口线串行接口使用芯片使能串行时钟和串行数据输入输出线串行接口使用芯片使能串行时钟和串行数据输入输出数据命令标志串行时钟仅用于与单片机的接口因此它可以在不需要通信时停止对于引脚的描述中我们明显看到只有一个所以是模式对于片选信号低电平时选中这个就是数据命令选择引脚当为低数据被视为命令当为高数据被视为数据参数低电平代表命令如设置窗口高电平代表参数或像素数据这个是时钟信号数据输入输出线在模式下变为输入新增引脚数据输入数据输出说明在看手册的过程中这几个引脚会在写命令时出现手册上经常混用为了避免弄混所以这里专门说明一下手册描述具体和的作用在对应的接口部分都有说明以下做一个区分在不同接口时作用不同主要有两种情况接口下就是用作是数据命令选择引脚此时代表命令和数据串行接口下被复用为时钟引脚通常可以看到原理图上被引出作为只在的接口并口通信时有用代表读使能对于其他情况下忽略即可在以下几种接口的作用不同主要情况如下接口并口下是写使能信号驱动芯片会在上升沿采集内容数据命令串行接口下线串行接口只用和未使用数据命令选择是传输数据位不用控制引脚我们直接不管即可线串行接口被复用为引脚是数据命令选择的功能通常可以看到原理图上被引出作为下用作第二数据线此情况为特殊情况大部分不用写命令了解完引脚之后我们就可以看如何发送命令发送命令的格式通信的时序等数据格式原文该接口的写模式意味着微控制器会将指令和数据写入液晶驱动器线串行数据包包含一个控制位和一个传输字节直接发送数据或然后启动直接对这个进行解析解析出来的决定是还是在线串行接口中数据包仅包含传输字节而控制位则通过引脚进行传输先设置引脚电平然后发送或然后驱动解析如果引脚为低则传输字节将被解释为命令字节如果引脚为高则该传输字节将被存储在显示数据内存写入命令中或者作为参数存储在命令寄存器中任何指令都可以以任意顺序发送给驱动器最高有效位首先传输串行接口在为高电平时被初始化在此状态下时钟脉冲或数据均不起作用的下降沿使串行接口启用并表示数据传输的开始时序原文描述为高时和都被忽略接口处于初始化空闲状态也就是说只有拉低后才开始收数据下降沿触发传输开始此时可以是高或低你不需要关心初始状态只要被拉低了就准备接收数据了数据线在时钟线每次上升沿被采样即每个字节的每一位数据都是在上升沿被锁存的作用就是区分命令数据命令参数内存数据需要根据发送内容切换的电平采样的时机线串口是在第一个上升沿被采样也就是说每个字节前携带一个位线串口是通过外部引脚传递会在每个上升沿即每发送一个字节时采样的电平所以你发命令时拉低发数据时拉高在每字节的第个上升沿采样当前状态如果保持低电平没有结束传输会等待下一个字节的或数据位读数据这里只会写入没有读取到时候用的时候再看手册吧显示开发时相关知识背光源背光层介绍屏幕采用了有机发光材料每个像素都可以发光也就是可以自发光不需要屏幕那样的背光层液晶层也能点亮因此可以做的更加轻薄实现屏下指纹柔性屏等特殊的功能屏幕的发光原理主要依靠背光层背光层发出白光背光层上有一层有颜色的薄膜透过薄膜之后就能显示出彩色在背光层和颜色薄膜之间液晶层调整红蓝绿的比例所以在嵌入式开发中很多屏幕会有一个单独的背光引脚常见标识为等用于控制亮度而屏幕则通常没有专门的背光引脚背光引脚背光引脚是液晶屏专门用于连接背光源通常是一排或多排灯的引脚通常是背光灯的负极以命名代表阴极工作原理液晶层本身不发光只能改变光的通过与阻挡背光点亮后光通过液晶层显示内容才能被人眼看到关闭背光屏幕就看不到内容我们可通过该引脚控制背光的亮灭为液晶面板提供照明从而使液晶层的内容显示或关闭同时我们还可以通过背光引脚控制背光源亮度实现屏幕亮度功耗的修改我们在使用屏幕时只有开启了背光源屏幕才能显示内容这主要就是通过控制我们的背光引脚来实现的背光引脚的使用硬件调光调光介绍是一种通过控制信号的高低电平持续时间比例占空比来调节输出功率的方法用在背光引脚时就是让背光在极高频率下快速开关人眼看到的是亮度的变化我们可以对背光引脚输出波通过控制波的占空比来控制背光的亮度进而控制屏幕的亮度占空比越高亮度越高占空比越低亮度越高使用注意事项频率选择频率过低低于人眼视觉融合阈值约会有频闪现象导致屏幕肉眼可见闪烁影响观感和舒适度长时间观看可能造成眼睛疲劳甚至头痛频率过高频率过高如几十以上可能导致驱动器件如三极管管切换损耗增加发热变大能耗上升甚至影响电磁兼容造成干扰某些驱动电路在高频下可能无法完全响应导致调光曲线不线性或亮度不稳定根据比较权威的国际标准和国内标准的报告频闪在以上时人眼就难以察觉但无法保证无危害性而在频率在以上时频闪危害基本处于低风险水平最高的无显著影响标准则是调光时波频率设置在都可以最好设置在以上背光引脚代码引脚配置主要是对我们的配置复用模式然后配置我们的输出对应的波直接使用配置即可我们这里的主频为所以配置为配置为使我们的波频率为驱动代码设置亮度设置的值控制占空比启动背光源关闭背光源注意在设置占空比的时候不要太低低于很多模块根本不亮或者闪烁影响实际效果像素格式像素格式介绍像素格式指图像数据存储所用的格式描述了像素在内存中的编码方式像素格式定义了每个像素所使用的总位数以及用于存储像素色彩的红绿蓝和分量的位数常见的有说明数越高颜色越丰富显示越细腻但每个像素需要的数据越多刷新速度越慢对要求越高绝大多数单片机项目都用位色因为速度和显示效果兼顾位色适合高端应用对和总线速率要求很高红色表示绿色表示蓝色表示白色数据代表红色数据为绿色数据为蓝色数据为合起来就是其他颜色同理红色表示绿色表示蓝色表示白色数据代表红色数据为绿色数据为蓝色数据为合起来就是其他颜色同理使用我们在初始化时常常会对的像素格式进行设置如就有一个命令对应参数设置为接口格式我们使用的是接口全部设置为即可设置为控制接口像素格式我们主要配置这里可以设置为通常我们在中使用的像素格式对应写入命令参数为初始化代码中对应的部分设置像素格式表示位色像素格式我们设置像素格式为后之后我们对于每个像素点就用数据代表颜色对每个点写入数据时我们就可以使用提前定义颜色对应的宏定义数据然后在设置好行列地址后将数据写入某个像素点即可拥有对应颜色该点写入白色该点写入黑色有关不同颜色对应的数据可以在网上去转换后自己宏定义即可或者可以手动转换初始化代码为什么要有这个初始化代码在我们购买屏幕的时候厂家一般会给你一段初始化代码这个代码有什么作用呢我们通常会看到有很多形状的屏幕他们使用的可能是相同的屏幕驱动芯片通过初始化代码设置告诉驱动芯片我们要驱动的屏幕尺寸是多少显示范围是多少显示频率一些电压等等是多少这样就可以使用同一种芯片驱动不同尺寸的屏幕了初始化代码示例对于一块屏幕的初始化代码厂家一般都会提供我们直接将其移植过来用即可一般不用了解内容但是了解一下初始化代码做了什么事情对于我理解有好处下面就介绍一下这个初始化代码一般干什么这是我买的触摸屏使用厂家给的初始化代码主要对以下几个方面进行配置退出睡眠内存访问控制主要是屏幕显示的方向翻转旋转和颜色顺序像素格式配置颜色大小直接影响每个像素需要的数据量和屏幕显示效果常设置为因为它色彩丰富速度合适数越高色彩越多但传输数据也越大电压电源相关命令这些命令用来调节屏幕的驱动电压对比度色彩和显示稳定性合理设置能适配不同屏幕优化显示效果防止异常一般用厂家推荐值特殊需要时可微调开启像素反相显示让液晶每个像素点的电压周期性反转像素反相开启反相后颜色会更饱满亮度更均匀开启显示上面这些命令我们按照对应手册命令部分的介绍进行了解和修改即可通常这些是在后续我们需要对屏幕进行优化的时候进行修改厂家给的可以直接使用这是我们手动添加的使用通信需要拉低引脚外部引脚硬件复位芯片开始初始化序列退出睡眠模式唤醒唤醒命令等待确保芯片完全唤醒手册要求设置参数显示驱动时的帧间隔同步等影响稳定性前后间隔时间帧间隔时序帧间隔时序开启撕裂信号通常用于同步显示表示关闭设置内存访问控制决定屏幕的扫描方向和排列竖屏正常方向横屏水平翻转竖屏垂直翻转横屏其他方向设置像素格式表示位色设置门极驱动控制影响扫描驱动电压设置电压影响对比度和显示质量设置电源控制调节显示驱动电压设置电源控制调节内部偏置设置电源控制进一步调节电压参数设置电源控制进一步调节电压参数设置驱动控制影响帧速率和电压设置正向电压控制设置负向电压控制设置校准参数影响色彩表现和灰阶显示显示反相让颜色更鲜亮防止残影开启显示从零开始开发显示驱动如何入手开发我们拿到一块屏幕的时候知道了他用的哪块芯片但是整个屏幕点亮到显示图像的流程是怎样的呢如何驱动屏幕呢我自己总结一下开发的全流程第一步阅读手册阅读屏幕手册了解使用的是什么驱动芯片驱动芯片使用的什么模式然后去阅读驱动芯片的手册详细了解对应的模式的通信流程如何发送命令等使用的就是四线驱动所以我们看手册时就关注四线即可第二步底层通讯协议的开发最开始肯定是对我们底层通讯协议等接收发送数据的开发主要是写命令写数据等第三步常用命令设置行列地址底层开发前言这里主要是先对通讯协议读写数据驱动写命令数据初始化设置行列地址进行开发主要是对驱动的通讯相关的开发好后供后续显示对应图像等提供接口以我们的这款屏幕为例使用的驱动是四线驱动头文件显示我们一般会先从头文件写起主要包括引脚宏定义通讯函数宏定义函数声明便于后续实现函数引脚宏定义宏函数初始化写数据命令行列地址设置低功耗相关补充函数接下来我们就分别来说明头文件内容引脚宏定义为了便于移植我们通常就会先将对应的相关引脚进行宏定义后续不用动上层的代码只需要改底层的引脚感觉手册和原理图定义即可引脚引脚引脚数据命令选择引脚片选引脚背光控制引脚通讯函数宏定义然后是对通讯过程中这些引脚需要拉低拉高的一个宏定义函数声明主要对我们底层通讯的一些函数进行声明写数据写命令设置行列地址等这里一般是边写边添加函数声明初始化写数据命令行列地址设置低功耗相关补充函数引脚初始化这里使用硬件对应的在其他地方配置了所以只需要初始化软件的引脚我们这里使用硬件其他的引脚使用软件模拟即可默认拉高通讯协议写数据然后就应该实现我们通讯协议的发送字节这里我们使用硬件进行封装层的发送函数即可硬件向发送一个字节软件芯片写命令数据然后就是封装我们对应向芯片发送命令数据的逻辑向写命令切换为写命令向写数据切换为写数据向写数据初始化这里的初始化实际上是我们的芯片的初始化对应写入一些参数配置这部分代码通常由厂家提供我们直接移植即可后续需要优化自己查手册对应参数修改即可复位芯片开始初始化序列退出睡眠模式唤醒唤醒命令等待确保芯片完全唤醒手册要求设置参数显示驱动时的帧间隔同步等影响稳定性前后间隔时间帧间隔时序帧间隔时序开启撕裂信号通常用于同步显示表示关闭设置内存访问控制决定屏幕的扫描方向和排列竖屏正常方向横屏水平翻转竖屏垂直翻转横屏其他方向设置像素格式表示位色设置门极驱动控制影响扫描驱动电压设置电压影响对比度和显示质量设置电源控制调节显示驱动电压设置电源控制调节内部偏置设置电源控制进一步调节电压参数设置电源控制进一步调节电压参数设置驱动控制影响帧速率和电压设置正向电压控制设置负向电压控制设置校准参数影响色彩表现和灰阶显示显示反相让颜色更鲜亮防止残影开启显示设置显示窗口行列地址显示流程想让上的每个像素显示出来我们首先得告诉我们想要显示的区域是哪里的起始和终止坐标所以我们在写入像素点数据之前需要先设置显示的行列地址流程图列地址列地址设置命令用于告诉接下来要在哪些列范围写入数据的起始水平坐标的结束水平坐标取值范围取值范围的值代表横竖屏两种的情况四线中不用管和具体原因请见上方引脚的说明只需要对引脚进行控制然后发送数据即可整个流程就是拉低引脚然后发送命令发送起始水平坐标的高发送起始水平坐标的低发送结束水平坐标的高发送结束水平坐标的低行地址列地址设置命令用于告诉接下来要在哪些行范围写入数据的起始垂直坐标的结束垂直坐标取值范围取值范围的值代表横竖屏两种的情况四线中不用管和具体原因请见上方引脚的说明只需要对引脚进行控制然后发送数据即可整个流程就是拉低引脚然后发送命令发送起始垂直坐标的高发送起始垂直坐标的低发送结束垂直坐标的高发送结束垂直坐标的低写显存是写显存的命令发送该命令后芯片会等待接收显存数据了同时当这个命令被接受时列寄存器和页寄存器被重置到设置的起始列起始页位置对应代码设置行列地址写显存命令设置的显示窗口起始和结束地址显示区域起始列地址显示区域起始行地址显示区域结束列地址显示区域结束行地址本函数通过向控制芯片发送命令和参数设置后续像素数据写入的目标区域只有设置好显示窗口后才能高效地在指定区域进行图像文字等内容的刷新操作常用于绘制图形局部刷新等场景提升操作效率命令高字节低字节高字节低字节命令高字节低字节高字节低字节发送该命令开始等待接收显存数据低功耗相关直接按照手册发送命令即可分别对应进入睡眠和退出睡眠模式退出睡眠手册要求至少延时进入睡眠手册要求至少延时其他补充还可以放一些其他于相关的比如我的项目中使用了切换数据宽度所以就放在这里了源文件总结以上实现得到的源文件我们这里使用硬件其他的引脚使用软件模拟即可默认拉高硬件向发送一个字节软件向写命令切换为写命令向写数据切换为写数据向写数据设置的显示窗口起始和结束地址显示区域起始列地址显示区域起始行地址显示区域结束列地址显示区域结束行地址本函数通过向控制芯片发送命令和参数设置后续像素数据写入的目标区域只有设置好显示窗口后才能高效地在指定区域进行图像文字等内容的刷新操作常用于绘制图形局部刷新等场景提升操作效率命令高字节低字节高字节低字节命令高字节低字节高字节低字节发送该命令开始等待接收显存数据退出睡眠手册要求至少延时进入睡眠手册要求至少延时复位芯片开始初始化序列退出睡眠模式唤醒唤醒命令等待确保芯片完全唤醒手册要求设置参数显示驱动时的帧间隔同步等影响稳定性前后间隔时间帧间隔时序帧间隔时序开启撕裂信号通常用于同步显示表示关闭设置内存访问控制决定屏幕的扫描方向和排列竖屏正常方向横屏水平翻转竖屏垂直翻转横屏其他方向设置像素格式表示位色设置门极驱动控制影响扫描驱动电压设置电压影响对比度和显示质量设置电源控制调节显示驱动电压设置电源控制调节内部偏置设置电源控制进一步调节电压参数设置电源控制进一步调节电压参数设置驱动控制影响帧速率和电压设置正向电压控制设置负向电压控制设置校准参数影响色彩表现和灰阶显示显示反相让颜色更鲜亮防止残影开启显示显示开发前言我们底层已经写好了这里就可以进行编写一些显示相关的函数了头文件底层驱动文件绘制相关包括画图形点线图形显示汉字字符整数图片等定义参考厂家代码设计背光相关设置每个像素对应的颜色数据棕色棕红色灰色深蓝色浅蓝色灰蓝色浅绿色浅灰色窗体背景色浅灰蓝色中间层颜色浅棕蓝色选择条目的反色下面分别介绍头文件内容函数声明主要对我们进行实际显示的一些供应用层使用包括区域填充画图形显示汉字字符数字等还有涉及到背光的需要我们开启背光才能显示绘制相关包括画图形点线图形显示汉字字符整数图片等定义参考厂家代码设计在指定位置画一个点背光相关设置宏定义我们底层使用的是的格式每个像素显示不同颜色我们需要提前定义好对应颜色的数据以便于应用层可以直接指定想要填充的颜色每个像素对应的颜色数据棕色棕红色灰色深蓝色浅蓝色灰蓝色浅绿色浅灰色窗体背景色浅灰蓝色中间层颜色浅棕蓝色选择条目的反色背光这里我们使用对背光引脚进行输出可以控制屏幕的亮度设置背光源亮度开启背光关闭背光显示开发填充区域写好底层后我们想要对应区域显示我们指定的颜色需要以下步骤设置显示行列地址写入像素数据设置显示范围写入对应的像素数据上面就是最基本的显示方法了但是我们通常都是使用的方式批量写入数据区域总像素个数每个像素画图形显示字符数字等显示图像源文件最终得到的文件如下唯一注意的就是我们需要根据实际情况实际测试时应该需要校准添加一个偏移量到我们的坐标时显示区域覆盖完我们的屏幕显示区域为显示对象设置显示范围区域总像素个数每个像素设置背光源亮度开启背光关闭背光其余部分是厂家给的画点画线等等的驱动我这里不使用就不移植了驱动测试代码编写编写完驱动之后我们通常会写一些参考示例测试我们的驱动同时后续以供别人使用填充测试这个是最基本的测试可以测试我们驱动是否有问题驱动编写完成之后我们就可以开始测试了初始化开启背光填充最终看屏幕有没有正常显示颜色正常显示代表成功否则可能是通讯协议数据格式偏移量的问题建议依次排查其他测试然后可以进行一些其他的点线图片测试等开发时可能的问题花屏问题调用填充函数时部分行花屏设置显示范围原因使用可操纵的分辨率而买到的屏幕是显示坐标不一定是从开始我们需要自己添加偏移量找到显示位置最终尝试后发现需要在轴添加的偏移量后屏幕显示正常所以该屏幕的实际显示坐标为对应的分辨率也满足设置显示范围',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-29 20:34:56',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://i.postimg.cc/fbN6bFqP/20220206101541-14a48.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="安知鱼的博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="安知鱼的博客"/><span class="back-menu-item-text">安知鱼的博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/keqiudi/keqiudi.github.io" title="我的博客仓库"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="我的博客仓库"/><span class="back-menu-item-text">我的博客仓库</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">THEDI的仓库</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AWS/" style="font-size: 1.05rem;">AWS<sup>2</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>2</sup></a><a href="/tags/CLion/" style="font-size: 1.05rem;">CLion<sup>2</sup></a><a href="/tags/CMake/" style="font-size: 1.05rem;">CMake<sup>1</sup></a><a href="/tags/ESP32/" style="font-size: 1.05rem;">ESP32<sup>1</sup></a><a href="/tags/FreeRTOS/" style="font-size: 1.05rem;">FreeRTOS<sup>5</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/LCD/" style="font-size: 1.05rem;">LCD<sup>2</sup></a><a href="/tags/LVGL/" style="font-size: 1.05rem;">LVGL<sup>7</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>8</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>2</sup></a><a href="/tags/PCB/" style="font-size: 1.05rem;">PCB<sup>2</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/keil/" style="font-size: 1.05rem;">keil<sup>1</sup></a><a href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">云服务<sup>3</sup></a><a href="/tags/%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" style="font-size: 1.05rem;">启动流程<sup>2</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 1.05rem;">嵌入式<sup>2</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">嵌入式安全<sup>3</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">架构<sup>2</sup></a><a href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">环境配置<sup>4</sup></a><a href="/tags/%E7%A1%AC%E4%BB%B6/" style="font-size: 1.05rem;">硬件<sup>5</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>3</sup></a><a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size: 1.05rem;">调试<sup>5</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">35</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%BD%AF%E4%BB%B6/" itemprop="url">嵌入式软件</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/LCD/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>LCD</span></a></span></div></div><h1 class="post-title" itemprop="name headline">LCD显示屏开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-08-29T12:29:13.000Z" title="发表于 2025-08-29 20:29:13">2025-08-29</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-08-29T12:34:56.510Z" title="更新于 2025-08-29 20:34:56">2025-08-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="LCD显示屏开发"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/assets/213.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/"><header><a class="post-meta-categories" href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%BD%AF%E4%BB%B6/" itemprop="url">嵌入式软件</a><a href="/tags/LCD/" tabindex="-1" itemprop="url">LCD</a><h1 id="CrawlerTitle" itemprop="name headline">LCD显示屏开发</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">THEDI</span><time itemprop="dateCreated datePublished" datetime="2025-08-29T12:29:13.000Z" title="发表于 2025-08-29 20:29:13">2025-08-29</time><time itemprop="dateCreated datePublished" datetime="2025-08-29T12:34:56.510Z" title="更新于 2025-08-29 20:34:56">2025-08-29</time></header><h1 id="LCD显示屏介绍"><a href="#LCD显示屏介绍" class="headerlink" title="LCD显示屏介绍"></a>LCD显示屏介绍</h1><h2 id="什么是LCD"><a href="#什么是LCD" class="headerlink" title="什么是LCD?"></a>什么是LCD?</h2><p>LCD（<code>Liquid Crystal Display</code>，液晶显示屏）是一种利用液晶材料的光电效应实现显示内容的平面显示设备。LCD广泛应用于嵌入式系统，如智能家居、工业控制、手持设备等。</p>
<h2 id="LCD基本结构"><a href="#LCD基本结构" class="headerlink" title="LCD基本结构"></a>LCD基本结构</h2><p>LCD主要由以下几部分组成：</p>
<ul>
<li><code>液晶层</code>：夹在两片玻璃基板之间，负责成像。</li>
<li><code>偏光片</code>：用于控制光线的通过与偏振。</li>
<li><code>电极层</code>：通过电信号控制液晶分子的排列。</li>
<li><code>驱动电路</code>：实现信号传递，控制显示内容。</li>
<li><strong><code>背光源</code></strong>：提供照明，使显示内容可见</li>
</ul>
<h2 id="LCD显示原理"><a href="#LCD显示原理" class="headerlink" title="LCD显示原理"></a>LCD显示原理</h2><p>LCD的显示原理是通过控制液晶分子的排列方式，改变光线的透射与反射，从而实现不同的显示效果。常见的显示方式有：</p>
<ul>
<li><strong>静态驱动</strong>：每个像素单独控制，适用于小尺寸LCD。</li>
<li><strong>动态驱动</strong>：通过扫描方式控制行列，适用于大尺寸LCD。</li>
</ul>
<h2 id="常见屏幕型号"><a href="#常见屏幕型号" class="headerlink" title="常见屏幕型号"></a>常见屏幕型号</h2><h3 id="字符型LCD（Character-LCD）"><a href="#字符型LCD（Character-LCD）" class="headerlink" title="字符型LCD（Character LCD）"></a>字符型LCD（Character LCD）</h3><ul>
<li><strong>特点</strong>：只能显示固定字符（如字母、数字），部分支持自定义简易符号。</li>
<li><strong>常见型号</strong>：1602（16列2行）、2004（20列4行）等。</li>
<li><strong>接口</strong>：并口（HD44780）、部分带I2C&#x2F;SPI扩展板。</li>
<li><strong>用途</strong>：仪表、家电、简单菜单等。</li>
</ul>
<h3 id="段码屏（Segment-LCD）"><a href="#段码屏（Segment-LCD）" class="headerlink" title="段码屏（Segment LCD）"></a>段码屏（Segment LCD）</h3><ul>
<li><strong>特点</strong>：只能显示预设的<code>数字</code>、<code>符号</code>或<code>图案</code>（如电子秤、万年历的数字段）。</li>
<li><strong>常见型号</strong>：7段、14段、定制段码等。</li>
<li><strong>接口</strong>：并口（直接控制每个段）。</li>
<li><strong>用途</strong>：<code>时钟</code>、<code>电子秤</code>、遥控器、家电面板等。</li>
</ul>
<h3 id="图形点阵LCD（Graphic-LCD）"><a href="#图形点阵LCD（Graphic-LCD）" class="headerlink" title="图形点阵LCD（Graphic LCD）"></a>图形点阵LCD（Graphic LCD）</h3><ul>
<li><strong>特点</strong>：支持显示任意点阵图形、汉字、图片等。</li>
<li><strong>常见型号</strong>：12864（128×64点）、NOKIA5110（84×48点）、ST7565等。</li>
<li><strong>接口</strong>：并口、SPI、I2C。</li>
<li><strong>用途</strong>：工业仪表、便携设备、复杂菜单、简易图形显示。</li>
</ul>
<h3 id="TFT彩色LCD（TFT-LCD）"><a href="#TFT彩色LCD（TFT-LCD）" class="headerlink" title="TFT彩色LCD（TFT LCD）"></a>TFT彩色LCD（TFT LCD）</h3><ul>
<li><strong>特点</strong>：全彩显示，高分辨率，支持图片&#x2F;动画&#x2F;复杂UI。</li>
<li><strong>常见型号</strong>：ST7735（128×160）、ST7789（240×240）、ILI9341（240×320）等。</li>
<li><strong>接口</strong>：SPI、并口、RGB、MIPI等。</li>
<li><strong>用途</strong>：智能穿戴、手持终端、车载中控、消费电子。</li>
</ul>
<h3 id="IPS宽视角LCD（IPS-LCD）"><a href="#IPS宽视角LCD（IPS-LCD）" class="headerlink" title="IPS宽视角LCD（IPS LCD）"></a>IPS宽视角LCD（IPS LCD）</h3><ul>
<li><strong>特点</strong>：TFT的改进型，色彩更好，可视角更大，响应更快。</li>
<li><strong>常见型号</strong>：与TFT同，通常会注明“IPS”。</li>
<li><strong>用途</strong>：智能终端、高端显示、UI界面。</li>
</ul>
<h3 id="OLED显示屏-非LCD"><a href="#OLED显示屏-非LCD" class="headerlink" title="OLED显示屏(非LCD)"></a>OLED显示屏(非LCD)</h3><ul>
<li><strong>特点</strong>：自发光，无需背光，厚度薄，对比度高，功耗低。</li>
<li><strong>常见型号</strong>：SSD1306（128×64）、SH1106等。</li>
<li><strong>接口</strong>：I2C、SPI。</li>
<li><strong>用途</strong>：智能手表、便携设备、低功耗场景。</li>
</ul>
<h3 id="主要区别总结"><a href="#主要区别总结" class="headerlink" title="主要区别总结"></a>主要区别总结</h3><table>
<thead>
<tr>
<th>类型</th>
<th>显示内容</th>
<th>色彩</th>
<th>代表型号</th>
<th>典型接口</th>
<th>主要用途</th>
</tr>
</thead>
<tbody><tr>
<td>字符型LCD</td>
<td>字符</td>
<td>单色</td>
<td>1602、2004</td>
<td>并口&#x2F;I2C</td>
<td>仪表、菜单</td>
</tr>
<tr>
<td>段码屏</td>
<td>数字&#x2F;符号</td>
<td>单色</td>
<td>7段、14段定制</td>
<td>并口</td>
<td>家电、计时器</td>
</tr>
<tr>
<td>点阵LCD</td>
<td>图形+文字</td>
<td>单色</td>
<td>12864、5110</td>
<td>并口&#x2F;SPI&#x2F;I2C</td>
<td>工业、定制图形</td>
</tr>
<tr>
<td><code>TFT LCD</code></td>
<td>图形&#x2F;图片&#x2F;动画</td>
<td><code>全彩</code></td>
<td>ILI9341等</td>
<td><code>SPI/并口</code></td>
<td><code>UI、动画、终端</code></td>
</tr>
<tr>
<td>IPS LCD</td>
<td>图形&#x2F;图片&#x2F;动画</td>
<td>全彩</td>
<td>IPS系列</td>
<td>SPI&#x2F;并口等</td>
<td>高清显示</td>
</tr>
<tr>
<td><code>OLED</code>(非LCD)</td>
<td>图形+文字</td>
<td><code>单/彩</code></td>
<td>SSD1306等</td>
<td><code>SPI/I2C</code></td>
<td><code>便携、低功耗</code></td>
</tr>
</tbody></table>
<h1 id="LCD开发手册解读"><a href="#LCD开发手册解读" class="headerlink" title="LCD开发手册解读"></a>LCD开发手册解读</h1><p>这里主要是记录我拿到一块屏幕该如何看手册，不至于一脸懵</p>
<p>还有就是LCD驱动时的一些思路，是为了学习开发驱动的过程和加快开发速度</p>
<h2 id="厂家代码"><a href="#厂家代码" class="headerlink" title="厂家代码"></a>厂家代码</h2><p>在实操使用情况都是先跟屏幕厂家拿初始化时序，不同屏幕先拿到厂家提供时序代码，再来修改使用，一般厂家会提供，自己瞎试很费劲,如果时序不对，驱动起来屏幕会花屏</p>
<p>一般厂家会给我们初始化代码和驱动代码，我们一般不进行全部从零开始开发，这个涉及到底层驱动的实现，一般很麻烦，我们实际开发产品的时候都是对厂家提供的<code>驱动</code>、<code>例程</code>等进行<code>移植+修改</code>，除非是芯片冷门没有驱动或有特殊性能优化需求的时候。</p>
<p><strong>原因主要如下</strong>：</p>
<p>驱动代码重复性很高，且容易出错</p>
<p>厂家&#x2F;模块商往往会提供参考驱动、Demo、移植包，甚至HAL库兼容的驱动。</p>
<h2 id="屏幕手册"><a href="#屏幕手册" class="headerlink" title="屏幕手册"></a>屏幕手册</h2><p>我们这里使用P169H002-CTP触摸屏，首先先对一定是屏幕的手册进行了解,具体分为以下几个方面</p>
<h3 id="总体描述"><a href="#总体描述" class="headerlink" title="总体描述"></a>总体描述</h3><p>手册先看总体描述，了解屏幕开发时比较关键的参数：<code>分辨率</code>、<code>驱动芯片</code>、<code>通信接口</code>，其余的看看就即可</p>
<p><strong>分辨率</strong>: 240×180</p>
<p><strong>驱动芯片</strong>: ST7789V</p>
<p><strong>通信接口</strong>：4-line SPI</p>
<ul>
<li><p><strong>特性</strong></p>
<ul>
<li>4 线 SPI 并行接口，方便与主控芯片连接。</li>
</ul>
</li>
<li><p><strong>应用场景</strong></p>
<ul>
<li>MPOS 设备（移动支付终端）</li>
<li>个人导航设备</li>
<li>其他需要高质量显示的设备</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726143949152.png" alt="image-20250726143949152"></p>
<p>全介绍：</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>规格</th>
<th>单位&#x2F;说明</th>
<th>备注说明</th>
</tr>
</thead>
<tbody><tr>
<td>屏幕尺寸</td>
<td>1.69</td>
<td>英寸（对角线）</td>
<td>常用于小型嵌入式设备</td>
</tr>
<tr>
<td>像素数量</td>
<td>240(RGB)(H) x 280(V)</td>
<td>像素</td>
<td>横向240，纵向280，RGB三色子像素</td>
</tr>
<tr>
<td>显示区域</td>
<td>27.97(H) x 32.63(V)</td>
<td>毫米</td>
<td>实际可视的显示区域</td>
</tr>
<tr>
<td>像素间距</td>
<td>0.11655(H) x 0.11655(V)</td>
<td>毫米</td>
<td>每个像素的物理间隔</td>
</tr>
<tr>
<td>外形尺寸</td>
<td>33.13 x 41.13 x 3.61</td>
<td>毫米</td>
<td>屏幕整体外壳尺寸</td>
</tr>
<tr>
<td>像素排列</td>
<td>RGB竖条</td>
<td>——</td>
<td>每像素按红绿蓝竖条排列</td>
</tr>
<tr>
<td>显示模式</td>
<td>Normally Black</td>
<td>——</td>
<td>默认状态为黑色底</td>
</tr>
<tr>
<td>视角</td>
<td>ALL</td>
<td>——</td>
<td>全视角，任意方向都能清晰看到</td>
</tr>
<tr>
<td>灰度反转方向</td>
<td>–</td>
<td>——</td>
<td>无特殊灰度反转</td>
</tr>
<tr>
<td>显示色彩</td>
<td>262K</td>
<td>——</td>
<td>18位色深，约26.2万种颜色</td>
</tr>
<tr>
<td>亮度</td>
<td>350</td>
<td>nit（cd&#x2F;m²）</td>
<td>屏幕亮度，适合室内外使用</td>
</tr>
<tr>
<td>对比度</td>
<td>1000:1</td>
<td>——</td>
<td>显示黑白对比效果</td>
</tr>
<tr>
<td>表面处理</td>
<td>——</td>
<td>——</td>
<td>未特别说明</td>
</tr>
<tr>
<td>接口类型</td>
<td>4线SPI</td>
<td>——</td>
<td>SPI串行接口，常见于嵌入式主控与LCD通信</td>
</tr>
<tr>
<td>背光类型</td>
<td>LED侧入式</td>
<td>——</td>
<td>LED灯从侧面照明</td>
</tr>
<tr>
<td>驱动芯片</td>
<td>ST7789V</td>
<td>——</td>
<td>负责与主控通信及驱动LCD显示</td>
</tr>
<tr>
<td>工作温度</td>
<td>-20～70</td>
<td>℃</td>
<td>适用环境温度范围</td>
</tr>
<tr>
<td>存储温度</td>
<td>-30～80</td>
<td>℃</td>
<td>存储时允许的温度范围</td>
</tr>
<tr>
<td>重量</td>
<td>——</td>
<td>g</td>
<td>未标注</td>
</tr>
</tbody></table>
<h3 id="引脚描述"><a href="#引脚描述" class="headerlink" title="引脚描述"></a>引脚描述</h3><p>然后是看引脚描述，一定要确定LCD各个引脚功能开发才能有大体思路，最后把哪些引脚属于哪部分相关的给分类</p>
<p>1.显示驱动芯片<code>ST7789V</code>相关（SPI接口）</p>
<p><code>D/C</code>：数据&#x2F;命令选择</p>
<p><code>CS</code>: SPI片选信号</p>
<p><code>SCL</code>: SPI时钟信号</p>
<p><code>SDA</code>: SPI数据输入&#x2F;输出引脚 </p>
<p><code>RESET</code>：外部复位信号</p>
<p>2.触摸芯片<code>CST816T</code>相关(I2C接口)</p>
<p><code>TP_SCL</code>: 触摸I2C时钟信号</p>
<p><code>TP_SDA</code>: 触摸I2C数据信号</p>
<p><code>TP_TRST</code>: 触摸复位信号</p>
<p><code>TP_TINT</code>: 触摸中断信号</p>
<p>屏幕英文手册：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250719201136911.png" alt="image-20250719201136911"></p>
<p>中文翻译：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250719201927226.png" alt="image-20250719201927226"></p>
<blockquote>
<p>D&#x2F;C引脚：Data&#x2F;Command引脚，0代表是发送命令，1代表发送数据</p>
</blockquote>
<h3 id="电气特性"><a href="#电气特性" class="headerlink" title="电气特性"></a>电气特性</h3><p>手册上这部分主要是进行硬件设计时需要关心的，软件暂时不用管</p>
<h2 id="ST7789"><a href="#ST7789" class="headerlink" title="ST7789"></a>ST7789</h2><h3 id="ST7789介绍"><a href="#ST7789介绍" class="headerlink" title="ST7789介绍"></a>ST7789介绍</h3><p>ST7889是一款常用于小尺寸<code>TFT-LCD</code>屏的显示驱动芯片。它集成了显示RAM、控制器和驱动器，支持多种显示接口（通常为SPI或并口），为嵌入式设备如手表、智能穿戴、工业仪表等提供图像显示解决方案。</p>
<p>ST7789 通过 SPI 或并行接口与主控芯片通信，能够驱动 RGB 或 MCU 接口的 LCD 屏幕。</p>
<p>特性：</p>
<p><code>1.支持分辨率</code></p>
<p>ST7789 支持常见的 LCD 分辨率，如 240x320、240x240 等。</p>
<p><code>2.内置GRAM（显存）</code></p>
<p>芯片内部集成显示缓冲区(GRAM)，方便主控MCU刷新显示内容。</p>
<p><code>3.通信接口</code></p>
<p>支持SPI、并口（MCU接口），部分型号支持I2C。</p>
<p><code>4.显示模式</code></p>
<p>支持 16 位（RGB565）和 18 位（RGB666）颜色深度。，可配置显示方向（横屏&#x2F;竖屏）。</p>
<p><code>5.电源管理</code></p>
<p>内部集成电源电路，支持低功耗模式，适合电池供电的设备。</p>
<p><code>6.命令集丰富</code></p>
<p>提供寄存器配置命令，可自定义显示区域、色彩格式、背光控制等。</p>
<h3 id="手册阅读"><a href="#手册阅读" class="headerlink" title="手册阅读"></a>手册阅读</h3><p>尽可能地只阅读我们需要的部分，减少耗时，下方的介绍顺序也是以后开发时推荐阅读手册的顺序</p>
<h4 id="特征介绍"><a href="#特征介绍" class="headerlink" title="特征介绍"></a>特征介绍</h4><p>首先直接看一下特征介绍: 大致看一下<code>分辨率</code>、<code>通信接口</code>等等</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726174412303.png" alt="image-20250726174412303"></p>
<h4 id="全引脚介绍"><a href="#全引脚介绍" class="headerlink" title="全引脚介绍"></a>全引脚介绍</h4><p>第六章是所有的引脚功能介绍，随便看看即可，是在要看只需要关注通信相关引脚、模式引脚等</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726183552033.png" alt="image-20250726183552033"></p>
<h4 id="通信接口"><a href="#通信接口" class="headerlink" title="通信接口"></a>通信接口</h4><p>我们之前在手册第二章特征描述中看到了ST7789支持的通信接口如下：</p>
<table>
<thead>
<tr>
<th>接口类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>8080系列MCU接口(并口)</code></td>
<td>支持8位、9位、16位、18位数据位宽，适用于高速数据传输</td>
</tr>
<tr>
<td><code>RGB接口（6/16/18位）</code></td>
<td>包含VSYNC、HSYNC、DOTCLK、ENABLE、DB[17:0]等信号，适合高分辨率彩色显示</td>
</tr>
<tr>
<td><code>3/4线SPI串行接口</code></td>
<td>即Serial Peripheral Interface，便于少管脚连接及嵌入式应用</td>
</tr>
<tr>
<td><code>VSYNC接口</code></td>
<td>专用同步信号接口，用于显示刷新同步</td>
</tr>
</tbody></table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726173653775.png" alt="image-20250726173653775"></p>
<p>然后就是找对我们关心的SPI串行接口通信相关部分： 我们可以看到第8章就对各个接口(8080、SPI)等功能进行详细描述，主要就是告诉我们该如何发送指令，数据等。</p>
<p>我们屏幕使用的是四线SPI，所以只关注四线SPI即可，主要看四线的引脚定义，如何写命令&#x2F;数据等</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726160426692.png" alt="image-20250726160426692"></p>
<h4 id="通信引脚定义"><a href="#通信引脚定义" class="headerlink" title="通信引脚定义"></a>通信引脚定义</h4><p>ST7789通过IM3、IM2、IM1、IM0电平决定芯片属于哪种接口模式，其中圈起来的是Serial Interface(SPI)，相关的模式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726182304530.png" alt="image-20250726182304530"></p>
<p>对于该屏幕<code>P169H002-CTP</code>上说的是<code>4线SPI模式</code>，对应原理上ST7789的IM0、IM1、IM2、IM3连接如图：0 1 1 0，也对应4线SPI的模式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726182349760.png" alt="image-20250726182349760"></p>
<p>所以我们就该去了解Serial Interface相关内容，主要是各个功能进行了解</p>
<p>ST7789的串行接口主要有四种引脚定义：<code>三线串行接口Ⅰ/Ⅱ</code>、<code>四线串行接口Ⅰ/Ⅱ</code></p>
<p>原文:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726161822078.png" alt="image-20250726161822078"></p>
<p>这部分说的是串行接口有3线&#x2F;9位或4线&#x2F;8位双向接口：</p>
<p>3线串行接口(3-line serial interfaceⅠ&#x2F;Ⅱ)使用：CSX（芯片使能），SCL（串行时钟）和SDA（串行数据输入&#x2F;输出）。</p>
<p>4线串行接口(4-line serial interfaceⅠ&#x2F;Ⅱ)使用：CSX（芯片使能），SCL（串行时钟）和SDA（串行数据输入&#x2F;输出），<code>D/CX</code>（数据&#x2F;命令标志）</p>
<p>串行时钟（SCL）仅用于与单片机的接口，因此它可以在不需要通信时停止。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726150654264.png" alt="image-20250726150654264"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726150711904.png" alt="image-20250726150711904"></p>
<p><code>P169H002-CTP：</code>对于引脚的描述中，我们明显看到只有一个SDA，所以是4-line serial interface I模式</p>
<p>对于4-line serial interface I：</p>
<ul>
<li><code>CSX</code>：片选信号，低电平时选中LCD</li>
<li><code>WRX(D/CX)</code>：这个就是数据&#x2F;命令选择引脚(D&#x2F;CX)，当WRX为低，数据被视为命令。当WRX为高，数据被视为数据&#x2F;参数<ul>
<li><strong>低电平</strong>：代表命令（如0x2A设置窗口）</li>
<li><strong>高电平</strong>：代表参数或像素数据</li>
</ul>
</li>
<li><code>DCX(SCL)</code>：这个是时钟信号SCL</li>
<li><code>SDA</code>：数据输入&#x2F;输出线</li>
</ul>
<p>在4-line serial interface Ⅱ模式下，SDA变为输入，新增SDO引脚</p>
<p><code>SDA</code>: 数据输入</p>
<p><code>SDO</code>：数据输出</p>
<h4 id="RDX、WRX、DCX说明"><a href="#RDX、WRX、DCX说明" class="headerlink" title="RDX、WRX、DCX说明"></a>RDX、WRX、DCX说明</h4><p>在看手册的过程中，RDX、WRX、DCX这几个引脚会在写命令时出现，手册上经常混用，为了避免弄混，所以这里专门说明一下</p>
<p>手册描述(具体RDX和WRX的作用在对应的接口部分都有说明，以下做一个区分)：</p>
<p><code>DCX：</code> 在不同接口时作用不同，主要有两种情况：</p>
<ul>
<li>8080接口下：DCX就是用作是数据&#x2F;命令选择引脚(D&#x2F;CX)，此时0&#x2F;1代表命令和数据</li>
<li><strong>串行接口(SPI)下</strong>: <code>DCX</code>被复用为<code>SCK</code>时钟引脚，通常可以看到原理图上<code>DCX</code>被引出作为<code>SCL/SCK</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726181112908.png" alt="image-20250726181112908"></p>
<p><code>RDX：</code>只在MCU的8080接口(并口)通信时有用，代表<code>读使能</code>，对于其他情况下忽略即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726181200455.png" alt="image-20250726181200455"></p>
<p><code>WRX：</code> 在以下几种接口的作用不同，主要情况如下</p>
<ul>
<li>8080接口(并口)下：WRX是<code>写使能</code>信号，LCD驱动芯片会在WRX上升沿(↑)采集内容(数据&#x2F;命令)</li>
<li><strong>串行接口(SPI)下</strong>:<ul>
<li>3线串行接口SPI：只用CSX&#x2F;SCL&#x2F;SDA，WRX和RDX未使用(数据&#x2F;命令选择是传输1bit数据位，不用控制引脚)，我们直接不管WRX即可</li>
<li><strong>4线串行接口SPI</strong>：<code>WRX</code>被复用为<code>DCX</code>引脚，是数据&#x2F;命令选择的功能，通常可以看到原理图上<code>WRX</code>被引出作为<code>RS/DCX</code></li>
</ul>
</li>
<li>Second Data lane下：WRX用作第二数据线(SDA2), 此情况为特殊情况，大部分不用</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726181214381.png" alt="image-20250726181214381"></p>
<h4 id="写命令"><a href="#写命令" class="headerlink" title="写命令"></a>写命令</h4><p>了解完引脚之后，我们就可以看如何发送命令，发送命令的格式、通信的时序等</p>
<h5 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h5><p>原文：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726162424293.png" alt="image-20250726162424293"></p>
<p>该接口的写模式意味着微控制器会将指令和数据写入液晶驱动器.</p>
<p><strong>3线串行数据包包含一个控制位D&#x2F;CX和一个传输字节</strong>: 直接发送数据1bit(D&#x2F;CX) + 8bit(Cmd 或 data)</p>
<p>然后ST7789启动IC直接对这个1bit+8bit进行解析，解析出来的1bit，决定8bit是Cmd还是data</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726162624322.png" alt="image-20250726162624322"></p>
<hr>
<p><strong>在4线串行接口中，数据包仅包含传输字节，而控制位D&#x2F;CX则通过D&#x2F;CX引脚进行传输</strong>: 先设置D&#x2F;CX引脚电平，然后发送8bit(Cmd 或 data)</p>
<p>然后ST7789驱动IC解析：如果D&#x2F;CX引脚为低，则传输字节将被解释为命令字节。如果D&#x2F;CX引脚为高，则该传输字节将被存储在显示数据RAM（内存写入命令）中，或者作为参数存储在命令寄存器中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726162759765.png" alt="image-20250726162759765"></p>
<p>任何指令都可以以任意顺序发送给驱动器。最高有效位(MSB）首先传输。串行接口在CSX为高电平时被初始化。在此状态下，SCL<br>时钟脉冲或SDA数据均不起作用。CSX的下降沿使串行接口启用，并表示数据传输的开始。</p>
<h5 id="时序"><a href="#时序" class="headerlink" title="时序"></a>时序</h5><p>原文描述：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726164808220.png" alt="image-20250726164808220"></p>
<ul>
<li><p>**CSX为高时，SCL和SDA都被忽略，接口处于初始化&#x2F;空闲状态。**也就是说，只有CSX拉低后，LCD才开始“收数据”。</p>
</li>
<li><p>**CSX下降沿触发传输开始，此时SCL可以是高或低。**你不需要关心SCL初始状态，只要CSX被拉低了，LCD就准备接收数据了。</p>
</li>
<li><p>**SDA（数据线）在 SCL（时钟线）每次上升沿被采样。**即每个字节的每一位数据都是在 SCL 上升沿被锁存。</p>
</li>
<li><p>**D&#x2F;CX 的作用就是区分命令&#x2F;数据（0&#x3D;命令，1&#x3D;参数&#x2F;内存数据）。**需要根据发送内容切换 D&#x2F;CX 的电平。</p>
</li>
<li><p><strong>采样D&#x2F;CX的时机：</strong></p>
<ul>
<li><strong>3线串口：</strong> D&#x2F;CX是在第一个 SCL 上升沿被采样（也就是说每个字节前携带一个 D&#x2F;CX 位）。</li>
<li><strong>4线串口：</strong> D&#x2F;CX是通过外部引脚传递，LCD会在每8个 SCL 上升沿（即每发送一个字节时）采样 D&#x2F;CX 的电平。<br>所以你发命令时 D&#x2F;CX 拉低，发数据时 D&#x2F;CX 拉高，LCD在每字节的第8个 SCL 上升沿采样当前 D&#x2F;CX 状态。</li>
</ul>
</li>
<li><p><strong>如果CSX保持低电平（没有结束传输），LCD会等待下一个字节的 D&#x2F;CX 或数据位。</strong></p>
</li>
</ul>
<p><code>4-line</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726163648023.png" alt="image-20250726163648023"></p>
<p><code>3-line</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726164204267.png" alt="image-20250726164204267"></p>
<h4 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h4><p>这里只会写入LCD，没有读取，到时候用的时候再看手册吧</p>
<h1 id="LCD显示开发时相关知识"><a href="#LCD显示开发时相关知识" class="headerlink" title="LCD显示开发时相关知识"></a>LCD显示开发时相关知识</h1><h2 id="LCD背光源-Back-Light"><a href="#LCD背光源-Back-Light" class="headerlink" title="LCD背光源(Back Light)"></a>LCD背光源(Back Light)</h2><h3 id="背光层介绍"><a href="#背光层介绍" class="headerlink" title="背光层介绍"></a>背光层介绍</h3><p><code>OLED</code>：屏幕采用了<code>有机发光材料</code>，每个像素都可以发光，也就是可以<code>自发光</code>，<strong>不需要LCD屏幕那样的背光层、液晶层，也能点亮</strong>。因此可以做的更加轻薄，实现屏下指纹、柔性屏等特殊的功能。</p>
<p><code>LCD</code>：屏幕的发光原理主要依靠<code>背光层</code>，背光层发出白光，背光层上有一层有颜色的薄膜，透过薄膜之后就能显示出彩色，在背光层和颜色薄膜之间液晶层，调整红蓝绿的比例。</p>
<p>所以在嵌入式开发中，很多LCD屏幕会有一个单独的背光引脚（常见标识为LEDK、BLK等）用于控制亮度</p>
<p>而OLED屏幕则通常没有专门的背光引脚。</p>
<h3 id="背光引脚"><a href="#背光引脚" class="headerlink" title="背光引脚"></a>背光引脚</h3><p><code>背光引脚</code>是液晶屏（LCD）专门用于连接<code>背光源</code>（通常是一排或多排LED灯）的引脚，通常是背光LED灯的<code>负极</code>（以“LEDK”命名，K代表Cathode阴极）。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>液晶层本身不发光，只能改变光的通过与阻挡。</li>
<li>背光LED点亮后，光通过液晶层，显示内容才能被人眼看到；关闭背光，屏幕就看不到内容。</li>
</ul>
<p>我们可通过该引脚控制背光LED的亮灭，为液晶面板提供照明，从而使<code>液晶层</code>的内容<code>显示或关闭</code>。</p>
<p>同时我们还可以通过背光引脚控制背光源亮度，实现屏幕亮度、功耗的修改</p>
<blockquote>
<p><strong>我们在使用LCD屏幕时只有开启了<code>背光源</code>，屏幕才能显示内容，这主要就是通过控制我们的背光引脚<code>LEDK</code>来实现的</strong></p>
</blockquote>
<h3 id="背光引脚的使用"><a href="#背光引脚的使用" class="headerlink" title="背光引脚的使用"></a>背光引脚的使用</h3><h4 id="硬件PWM调光"><a href="#硬件PWM调光" class="headerlink" title="硬件PWM调光"></a>硬件PWM调光</h4><h5 id="调光介绍"><a href="#调光介绍" class="headerlink" title="调光介绍"></a>调光介绍</h5><p>​	PWM是一种通过控制信号的高低电平持续时间比例（占空比）来调节输出功率的方法。用在背光引脚时，就是让背光LED在极高频率下“快速开关”，人眼看到的是亮度的变化。</p>
<p>我们可以对背光引脚输出PWM波，通过控制PWM波的<code>占空比</code>来控制背光LED的亮度，进而控制屏幕的亮度。</p>
<p>占空比<code>越高</code>，LCD亮度<code>越高</code></p>
<p>占空比<code>越低</code>，LCD亮度<code>越高</code></p>
<h5 id="使用PWM注意事项"><a href="#使用PWM注意事项" class="headerlink" title="使用PWM注意事项"></a>使用PWM注意事项</h5><p><code>PWM频率选择</code>:</p>
<ul>
<li><strong>频率过低</strong>  <ul>
<li>低于人眼视觉融合阈值（约100Hz~200Hz），会有<code>频闪</code>现象，导致屏幕<strong>肉眼可见闪烁</strong>，影响观感和舒适度，长时间观看可能造成眼睛疲劳甚至头痛。</li>
</ul>
</li>
<li><strong>频率过高</strong>  <ul>
<li>频率过高（如几十kHz以上），可能导致<strong>驱动器件（如三极管&#x2F;MOS管）切换损耗增加</strong>，发热变大，能耗上升，甚至影响电磁兼容（EMC），造成干扰。</li>
<li>某些LED驱动电路在高频下可能无法完全响应，导致调光曲线不线性或亮度不稳定。</li>
</ul>
</li>
</ul>
<p>根据比较权威的IEEE Std1789-2015国际标准和国内标准的报告，频闪在400Hz以上时人眼就难以察觉，但无法保证无危害性，而在PWM频率在1250Hz以上时，频闪危害基本处于低风险水平，最高的无显著影响标准则是<code>3125Hz</code>。</p>
<p>PWM调光时，PWM波频率设置在1kHz~20kHz都可以。最好设置在<code>3125Hz</code>以上</p>
<h3 id="背光引脚代码"><a href="#背光引脚代码" class="headerlink" title="背光引脚代码"></a>背光引脚代码</h3><h4 id="引脚配置"><a href="#引脚配置" class="headerlink" title="引脚配置"></a>引脚配置</h4><p>主要是对我们的GPIO配置复用模式，然后配置我们的TIM输出对应的PWM波,直接使用CubeMX配置TIM即可</p>
<p>我们这里的主频为100MHz，所以PSC配置为<code>320</code>，ARR配置为<code>100</code>, 使我们的PWM波频率为<code>3125Hz</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250728163239160.png" alt="image-20250728163239160"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250728163248478.png" alt="image-20250728163248478"></p>
<h4 id="驱动代码"><a href="#驱动代码" class="headerlink" title="驱动代码"></a>驱动代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置亮度，设置CCR的值控制占空比</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Set_Light</span><span class="params">(<span class="type">uint8_t</span> duty)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(duty &gt;=<span class="number">5</span> &amp;&amp; duty &lt;=<span class="number">100</span>)</span><br><span class="line">	__HAL_TIM_SetCompare(&amp;htim3,TIM_CHANNEL_3,duty*<span class="number">320</span>/<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 启动背光源</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Open_BackLight</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_TIM_PWM_Start(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//关闭背光源</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Close_BackLight</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_TIM_PWM_Stop(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意在设置占空比的时候不要太低duty&lt;5%，<code>低于5%很多LED模块根本不亮或者闪烁，影响实际效果</code>。</p>
</blockquote>
<h2 id="LCD像素格式"><a href="#LCD像素格式" class="headerlink" title="LCD像素格式"></a>LCD像素格式</h2><h3 id="像素格式介绍"><a href="#像素格式介绍" class="headerlink" title="像素格式介绍"></a>像素格式介绍</h3><p><code>像素格式</code>：指图像数据存储所用的格式，描述了像素在内存中的编码方式。像素格式定义了<code>每个像素</code>所使用的<code>总位数</code>以及用于存储像素色彩的红、绿、蓝和 alpha 分量的位数。常见的有<code>12/16/18/24</code> bit&#x2F;pixel</p>
<p><code>说明</code>：</p>
<ul>
<li><p><strong>bit数越高，颜色越丰富、显示越细腻，但每个像素需要的数据越多，刷新速度越慢，对MCU要求越高。</strong></p>
</li>
<li><p>绝大多数STM32&#x2F;单片机项目都用16位色（RGB565），因为速度和显示效果兼顾。18&#x2F;24位色适合高端应用，对MCU和总线速率要求很高。</p>
</li>
</ul>
<p><code>RGB565(16bit)</code>：红色5bit表示，绿色6bit表示，蓝色5bit表示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250728182259774.png" alt="image-20250728182259774"></p>
<blockquote>
<p><strong>白色数据(0xFFFF)</strong>：代表红色数据为11111，绿色数据为111111，蓝色数据为11111，合起来就是0x1111111111111111(0xFFFF)</p>
<p>其他颜色同理</p>
</blockquote>
<p><code>RGB888(24bit)</code>：红色8bit表示，绿色8bit表示，蓝色8bit表示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250728182509918.png" alt="image-20250728182509918"></p>
<blockquote>
<p><strong>白色数据(0xFFFFFF)</strong>：代表红色数据为11111111，绿色数据为11111111，蓝色数据为11111111，合起来就是0x111111111111111111111111(0xFFFFFF)</p>
<p>其他颜色同理</p>
</blockquote>
<h3 id="LCD使用"><a href="#LCD使用" class="headerlink" title="LCD使用"></a>LCD使用</h3><p>我们在LCD初始化时，常常会对LCD的像素格式进行设置，如ST7789就有一个命令<code>COLMOD</code>(0x3A)：</p>
<p>对应参数D7~D0:</p>
<ul>
<li>D7: 设置为0</li>
<li>D6~D4: RGB接口格式，我们使用的是SPI接口，全部设置为0即可</li>
<li>D3: 设置为0</li>
<li>D2~D0： MCU控制接口像素格式, 我们主要配置这里，可以设置为12bit、16bit、18bit、16M</li>
</ul>
<p>通常我们在MCU中使用<code>16bit</code>的像素格式，对应写入命令参数为:0x05(0000 0101)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250728181323380.png" alt="image-20250728181323380"></p>
<p>初始化代码中对应的部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7. 设置像素格式（COLMOD），0x05表示16位色(RGB565)</span></span><br><span class="line">LCD_Write_Cmd(<span class="number">0x3A</span>);   </span><br><span class="line">LCD_Write_Data8(<span class="number">0x05</span>); <span class="comment">// 0 000 0 101  16bit像素格式</span></span><br></pre></td></tr></table></figure>



<p>我们设置像素格式为16bit后，之后我们对于每个像素点就用16bit数据代表颜色，对每个点写入数据时我们就可以使用提前定义颜色对应的宏定义16bit数据</p>
<p>然后在设置好行列地址后，将16bit数据写入某个像素点即可拥有对应颜色</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250728184456328.png" alt="image-20250728184456328"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LCD_Write_Data16(WHITE); <span class="comment">//该点写入白色</span></span><br><span class="line">LCD_Write_Data16(BLACK); <span class="comment">//该点写入黑色</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>有关不同RGB颜色对应的16bit数据可以在网上去转换后自己宏定义即可，或者可以手动转换</p>
</blockquote>
<h2 id="LCD初始化代码"><a href="#LCD初始化代码" class="headerlink" title="LCD初始化代码"></a>LCD初始化代码</h2><h3 id="为什么要有这个LCD初始化代码？"><a href="#为什么要有这个LCD初始化代码？" class="headerlink" title="为什么要有这个LCD初始化代码？"></a>为什么要有这个LCD初始化代码？</h3><p>在我们购买屏幕的时候，厂家一般会给你一段初始化代码，这个代码有什么作用呢?</p>
<p>我们通常会看到有很多形状的屏幕，他们使用的可能是相同的屏幕驱动芯片(ST7789), 通过初始化代码设置(告诉)驱动芯片,我们要驱动的屏幕尺寸是多少、显示范围是多少、显示频率、一些电压等等是多少。这样就可以使用同一种芯片驱动不同尺寸的屏幕了</p>
<h3 id="初始化代码示例"><a href="#初始化代码示例" class="headerlink" title="初始化代码示例"></a>初始化代码示例</h3><p>对于一块屏幕的初始化代码，厂家一般都会提供，我们直接将其移植过来用即可，一般不用了解内容，但是了解一下初始化代码做了什么事情对于我理解LCD有好处</p>
<p>下面就介绍一下这个初始化代码一般干什么</p>
<p>这是我买的P169H002-CTP触摸屏(使用ST7789)厂家给的初始化代码，主要对以下几个方面进行配置：</p>
<ul>
<li><p><code>Sleep Out</code>(0x11):退出睡眠</p>
</li>
<li><p><code>MADCTL</code>(0x36): 内存访问控制，主要是<strong>屏幕显示的方向、翻转、旋转和颜色顺序</strong></p>
</li>
<li><p><code>COLMOD</code>(0x3A): <strong>LCD像素格式配置，颜色 bit 大小直接影响每个像素需要的数据量和屏幕显示效果。MCU常设置为<code>16bit</code>&#x2F;pixel（RGB565），因为它色彩丰富、速度合适。bit数越高，色彩越多，但传输数据也越大。</strong></p>
</li>
<li><p><code>电压/电源相关命令</code>： <strong>这些命令用来调节 LCD 屏幕的驱动电压、对比度、色彩和显示稳定性。合理设置能适配不同屏幕、优化显示效果、防止异常。一般用厂家推荐值，特殊需要时可微调</strong></p>
</li>
<li><p><code>INVON</code> (0x21): 开启<strong>像素反相显示</strong>，让液晶每个像素点的电压周期性反转（像素反相），开启反相后，颜色会更饱满，亮度更均匀</p>
</li>
<li><p><code>DISPON</code>(0x29): 开启LCD显示</p>
</li>
</ul>
<p>上面这些命令我们按照对应ST7789手册命令部分的介绍进行了解和修改即可，通常这些是在后续我们需要对屏幕进行优化的时候进行修改，厂家给的可以直接使用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_GPIO_Init();</span><br><span class="line">	LCD_CS_LOW();		<span class="comment">//这是我们手动添加的，使用SPI通信需要拉低CS引脚</span></span><br><span class="line">	</span><br><span class="line">	LCD_RST_LOW(); <span class="comment">//外部引脚硬件复位芯片</span></span><br><span class="line">	delay_ms(<span class="number">100</span>);</span><br><span class="line">	LCD_RST_HIGH();</span><br><span class="line">	delay_ms(<span class="number">100</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*开始初始化序列*/</span></span><br><span class="line"> <span class="comment">//************* Start Initial Sequence **********//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 退出睡眠模式，唤醒LCD</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x11</span>);   <span class="comment">// Sleep Out（唤醒命令）</span></span><br><span class="line">    delay_ms(<span class="number">120</span>);      <span class="comment">// 等待120ms，确保芯片完全唤醒（手册要求）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 设置 Porch 参数（显示驱动时的帧间隔、同步等，影响稳定性）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xB2</span>);   <span class="comment">// Porch Setting</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>); <span class="comment">// 前 Porch</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>); <span class="comment">// 后 Porch</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x00</span>); <span class="comment">// 间隔时间</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>); <span class="comment">// 帧间隔/时序</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>); <span class="comment">// 帧间隔/时序</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 开启撕裂信号（Tearing Effect Line），通常用于同步显示，0表示关闭</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x35</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x00</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 设置内存访问控制（MADCTL），决定屏幕的扫描方向和RGB排列</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x36</span>);   </span><br><span class="line">    <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">0</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0x00</span>); <span class="comment">// 竖屏，正常方向</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">1</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0xC0</span>); <span class="comment">// 横屏，水平翻转</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">2</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0x70</span>); <span class="comment">// 竖屏，垂直翻转</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        LCD_Write_Data8(<span class="number">0xA0</span>); <span class="comment">// 横屏，其他方向</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 设置像素格式（COLMOD），0x05表示16位色(RGB565)</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x3A</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x05</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 设置门极驱动控制（Gate Control），影响扫描驱动电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xB7</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x35</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. 设置VCOM电压，影响对比度和显示质量</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xBB</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2D</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10. 设置电源控制（Power Control 1），调节显示驱动电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2C</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11. 设置电源控制（Power Control 2），调节内部偏置</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC2</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x01</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12. 设置电源控制（Power Control 3），进一步调节电压参数</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC3</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 13. 设置电源控制（Power Control 4），进一步调节电压参数</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC4</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 14. 设置驱动控制（VDV and VRH Command Enable），影响帧速率和电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC6</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0F</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15. 设置正向电压控制（Positive Voltage Gamma Control）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xD0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA4</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 16. 设置负向电压控制（Negative Voltage Gamma Control）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xD6</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 17. 设置Gamma校准参数（影响色彩表现和灰阶显示）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xE0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x70</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x05</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0A</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0B</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0A</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x27</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x44</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x47</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x37</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x14</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x14</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x29</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line"></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xE1</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x70</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x07</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x08</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x08</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x04</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x46</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x18</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2B</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2D</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 18. 显示反相（Display Inversion On），让颜色更鲜亮，防止残影</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x21</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 19. 开启显示（Display On）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x29</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="从零开始开发显示驱动"><a href="#从零开始开发显示驱动" class="headerlink" title="从零开始开发显示驱动"></a>从零开始开发显示驱动</h1><h2 id="如何入手开发LCD"><a href="#如何入手开发LCD" class="headerlink" title="如何入手开发LCD"></a>如何入手开发LCD</h2><p>我们拿到一块LCD屏幕的时候，知道了他用的哪块芯片，但是整个屏幕点亮到显示图像的流程是怎样的呢，如何驱动屏幕呢，我自己总结一下LCD开发的全流程</p>
<p><code>第一步</code>:阅读手册</p>
<p>1.阅读屏幕手册，了解使用的是什么驱动芯片，驱动芯片使用的什么模式</p>
<p>2.然后去阅读驱动芯片的手册，详细了解对应的模式的通信流程、如何发送命令等</p>
<p>P169H002-CTP 使用的就是四线SPI，ST7789驱动，所以我们看ST7789手册时，就关注四线SPI即可</p>
<p><code>第二步：</code>底层通讯协议的开发</p>
<p>最开始肯定是对我们底层通讯协议(I2C、SPI等)接收、发送数据的开发，主要是<code>写命令</code>、<code>写数据(1byte/2byte)</code>等</p>
<p><code>第三步：</code> </p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>设置行&#x2F;列地址：0x2B&#x2F;0x2A</p>
<h2 id="LCD底层开发"><a href="#LCD底层开发" class="headerlink" title="LCD底层开发"></a>LCD底层开发</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这里主要是先对<code>通讯协议读写数据</code>、<code>驱动IC ST7789写命令/数据</code>、<code>LCD初始化</code>、<code>LCD设置行列地址</code>进行开发，主要是对驱动IC ST7789的通讯相关的，开发好后供后续LCD显示对应图像等提供接口</p>
<p>以我们的P169H002-CTP这款屏幕为例，使用的驱动IC是ST7789V，四线<code>SPI</code>驱动。</p>
<h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><p>LCD显示我们一般会先从头文件写起，主要包括：<code>引脚宏定义</code>、<code>通讯函数宏定义</code>、<code>函数声明</code></p>
<p>便于后续实现函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LCD_ST7789_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LCD_ST7789_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;spi.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tim.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> USE_HORIZONTAL 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 引脚宏定义 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_PORT   GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_PIN    GPIO_PIN_3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_PORT   GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_PIN    GPIO_PIN_5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_PORT     GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_PIN      GPIO_PIN_8</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_PORT    GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_PIN     GPIO_PIN_7</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_PORT  	  GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_PIN 			GPIO_PIN_9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_PORT    GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_PIN     GPIO_PIN_0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 宏函数 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_LOW()      HAL_GPIO_WritePin(LCD_SCLK_PORT, LCD_SCLK_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_HIGH()     HAL_GPIO_WritePin(LCD_SCLK_PORT, LCD_SCLK_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_LOW()      HAL_GPIO_WritePin(LCD_MOSI_PORT, LCD_MOSI_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_HIGH()     HAL_GPIO_WritePin(LCD_MOSI_PORT, LCD_MOSI_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_LOW()     	HAL_GPIO_WritePin(LCD_RST_PORT, LCD_RST_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_HIGH()    	HAL_GPIO_WritePin(LCD_RST_PORT, LCD_RST_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_LOW()        HAL_GPIO_WritePin(LCD_DC_PORT, LCD_DC_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_HIGH()       HAL_GPIO_WritePin(LCD_DC_PORT, LCD_DC_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_LOW()        HAL_GPIO_WritePin(LCD_CS_PORT, LCD_CS_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_HIGH()       HAL_GPIO_WritePin(LCD_CS_PORT, LCD_CS_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_LOW()        HAL_GPIO_WritePin(LCD_BLK_PORT, LCD_BLK_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_HIGH()       HAL_GPIO_WritePin(LCD_BLK_PORT, LCD_BLK_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD初始化 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD写数据/命令*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Cmd</span><span class="params">(u8 data)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data8</span><span class="params">(u8 data)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data16</span><span class="params">(u16 data)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD行列地址设置 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Address_Set</span><span class="params">(u16 x1,u16 y1,u16 x2,u16 y2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD低功耗相关 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepOut</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepIn</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 补充函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_SPI_SetBit</span><span class="params">(u8 bit)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>



<p>接下来我们就分别来说明头文件内容：</p>
<p><code>引脚宏定义</code>：为了便于移植，我们通常就会先将对应的LCD相关引脚进行宏定义，后续不用动上层的代码，只需要改底层的引脚，感觉手册和<strong>原理图</strong>定义即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* SPI SCLK引脚*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_PORT   GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_PIN    GPIO_PIN_3  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SPI MOSI引脚*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_PORT   GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_PIN    GPIO_PIN_5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SPI RST引脚*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_PORT    GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_PIN     GPIO_PIN_7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ST7789数据/命令选择引脚*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_PORT  	  GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_PIN 			GPIO_PIN_9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 片选引脚 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_PORT     GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_PIN      GPIO_PIN_8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD背光控制引脚 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_PORT    GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_PIN     GPIO_PIN_0</span></span><br></pre></td></tr></table></figure>



<p><code>通讯函数宏定义</code>：然后是对通讯过程中这些引脚需要拉低拉高的一个宏定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_LOW()      HAL_GPIO_WritePin(LCD_SCLK_PORT, LCD_SCLK_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_HIGH()     HAL_GPIO_WritePin(LCD_SCLK_PORT, LCD_SCLK_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_LOW()      HAL_GPIO_WritePin(LCD_MOSI_PORT, LCD_MOSI_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_HIGH()     HAL_GPIO_WritePin(LCD_MOSI_PORT, LCD_MOSI_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_LOW()     	HAL_GPIO_WritePin(LCD_RST_PORT, LCD_RST_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RST_HIGH()    	HAL_GPIO_WritePin(LCD_RST_PORT, LCD_RST_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_LOW()        HAL_GPIO_WritePin(LCD_DC_PORT, LCD_DC_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_HIGH()       HAL_GPIO_WritePin(LCD_DC_PORT, LCD_DC_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_LOW()        HAL_GPIO_WritePin(LCD_CS_PORT, LCD_CS_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_HIGH()       HAL_GPIO_WritePin(LCD_CS_PORT, LCD_CS_PIN, GPIO_PIN_SET)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_LOW()        HAL_GPIO_WritePin(LCD_BLK_PORT, LCD_BLK_PIN, GPIO_PIN_RESET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_HIGH()       HAL_GPIO_WritePin(LCD_BLK_PORT, LCD_BLK_PIN, GPIO_PIN_SET)</span></span><br></pre></td></tr></table></figure>



<p><code>函数声明：</code> 主要对我们底层LCD通讯的一些函数进行声明，写数据、写命令、设置行列地址等，这里一般是边写边添加函数声明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* LCD初始化 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD写数据/命令*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Cmd</span><span class="params">(u8 data)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data8</span><span class="params">(u8 data)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data16</span><span class="params">(u16 data)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD行列地址设置 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Address_Set</span><span class="params">(u16 x1,u16 y1,u16 x2,u16 y2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD低功耗相关 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepOut</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepIn</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 补充函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_SPI_SetBit</span><span class="params">(u8 bit)</span>;<span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure>





<h3 id="引脚初始化"><a href="#引脚初始化" class="headerlink" title="引脚初始化"></a>引脚初始化</h3><p>这里使用硬件SPI，对应的SPI在其他地方配置了，所以只需要初始化软件的<code>CS</code>、<code>DC</code>、<code>RST</code>引脚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 我们这里使用硬件SPI，其他的CS/DC/RST引脚使用软件模拟*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LCD_GPIO_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">		GPIO_InitTypeDef  GPIO_InitStructure = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		</span><br><span class="line">		__HAL_RCC_GPIOB_CLK_ENABLE();</span><br><span class="line">		</span><br><span class="line">		GPIO_InitStructure.Pin = LCD_CS_PIN | LCD_DC_PIN | LCD_RST_PIN;</span><br><span class="line">		GPIO_InitStructure.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">		GPIO_InitStructure.Pull = GPIO_PULLUP;</span><br><span class="line">		GPIO_InitStructure.Speed = GPIO_SPEED_FREQ_HIGH; <span class="comment">// 50MHz即可</span></span><br><span class="line">		HAL_GPIO_Init(GPIOB,&amp;GPIO_InitStructure);</span><br><span class="line">		</span><br><span class="line">		HAL_GPIO_WritePin(GPIOB, LCD_CS_PIN | LCD_DC_PIN | LCD_RST_PIN, GPIO_PIN_SET); <span class="comment">//默认拉高</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="通讯协议写数据"><a href="#通讯协议写数据" class="headerlink" title="通讯协议写数据"></a>通讯协议写数据</h3><p>然后就应该实现我们通讯协议的发送字节，这里我们使用硬件SPI，进行封装HAL层的SPI发送函数即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 硬件SPI向ST7789发送一个字节*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LCD_Write_Byte</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="comment">//hardware spi</span></span><br><span class="line">		HAL_SPI_Transmit(&amp;hspi1,&amp;data,<span class="number">1</span>,HAL_MAX_DELAY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 软件spi*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LCD_Write_Byte_Soft</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="comment">//software spi</span></span><br><span class="line">	  <span class="keyword">for</span>(<span class="type">uint8_t</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">				LCD_SCLK_LOW();</span><br><span class="line">			  <span class="keyword">if</span>( data &amp; (<span class="number">0x80</span> &gt;&gt; i))</span><br><span class="line">					LCD_MOSI_HIGH();</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					LCD_MOSI_LOW();</span><br><span class="line">				</span><br><span class="line">				LCD_SCLK_HIGH();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="芯片写命令-数据"><a href="#芯片写命令-数据" class="headerlink" title="芯片写命令&#x2F;数据"></a>芯片写命令&#x2F;数据</h3><p>然后就是封装我们对应向ST7789芯片发送<code>命令/数据</code>的逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* LCD向ST7789写命令*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Cmd</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_DC_LOW(); <span class="comment">// 切换为写命令</span></span><br><span class="line">	LCD_Write_Byte(data);</span><br><span class="line">	LCD_DC_HIGH();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*LCD向ST7789写8bit数据*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data8</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_DC_HIGH(); <span class="comment">// 切换为写数据</span></span><br><span class="line">	LCD_Write_Byte(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*LCD向ST7789写16bit数据*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data16</span><span class="params">(u16 data)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_DC_HIGH();</span><br><span class="line">	LCD_Write_Byte(data &gt;&gt; <span class="number">8</span>);</span><br><span class="line">	LCD_Write_Byte(data &amp; <span class="number">0xFF</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="LCD初始化"><a href="#LCD初始化" class="headerlink" title="LCD初始化"></a>LCD初始化</h3><p>这里的LCD初始化实际上是我们的ST7789芯片的初始化，对应写入一些参数配置。</p>
<p><strong>这部分代码通常由厂家提供，我们直接移植即可，后续需要优化自己查手册对应参数修改即可</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_GPIO_Init();</span><br><span class="line">	LCD_CS_LOW();		<span class="comment">//chip select</span></span><br><span class="line">	</span><br><span class="line">	LCD_RST_LOW(); <span class="comment">//复位芯片</span></span><br><span class="line">	delay_ms(<span class="number">100</span>);</span><br><span class="line">	LCD_RST_HIGH();</span><br><span class="line">	delay_ms(<span class="number">100</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*开始初始化序列*/</span></span><br><span class="line"> <span class="comment">//************* Start Initial Sequence **********//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 退出睡眠模式，唤醒LCD</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x11</span>);   <span class="comment">// Sleep Out（唤醒命令）</span></span><br><span class="line">    delay_ms(<span class="number">120</span>);      <span class="comment">// 等待120ms，确保芯片完全唤醒（手册要求）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 设置 Porch 参数（显示驱动时的帧间隔、同步等，影响稳定性）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xB2</span>);   <span class="comment">// Porch Setting</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>); <span class="comment">// 前 Porch</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>); <span class="comment">// 后 Porch</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x00</span>); <span class="comment">// 间隔时间</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>); <span class="comment">// 帧间隔/时序</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>); <span class="comment">// 帧间隔/时序</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 开启撕裂信号（Tearing Effect Line），通常用于同步显示，0表示关闭</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x35</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x00</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 设置内存访问控制（MADCTL），决定屏幕的扫描方向和RGB排列</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x36</span>);   </span><br><span class="line">    <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">0</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0x00</span>); <span class="comment">// 竖屏，正常方向</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">1</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0xC0</span>); <span class="comment">// 横屏，水平翻转</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">2</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0x70</span>); <span class="comment">// 竖屏，垂直翻转</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        LCD_Write_Data8(<span class="number">0xA0</span>); <span class="comment">// 横屏，其他方向</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 设置像素格式（COLMOD），0x05表示16位色(RGB565)</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x3A</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x05</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 设置门极驱动控制（Gate Control），影响扫描驱动电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xB7</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x35</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. 设置VCOM电压，影响对比度和显示质量</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xBB</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2D</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10. 设置电源控制（Power Control 1），调节显示驱动电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2C</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11. 设置电源控制（Power Control 2），调节内部偏置</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC2</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x01</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12. 设置电源控制（Power Control 3），进一步调节电压参数</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC3</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 13. 设置电源控制（Power Control 4），进一步调节电压参数</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC4</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 14. 设置驱动控制（VDV and VRH Command Enable），影响帧速率和电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC6</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0F</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15. 设置正向电压控制（Positive Voltage Gamma Control）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xD0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA4</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 16. 设置负向电压控制（Negative Voltage Gamma Control）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xD6</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 17. 设置Gamma校准参数（影响色彩表现和灰阶显示）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xE0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x70</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x05</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0A</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0B</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0A</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x27</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x44</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x47</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x37</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x14</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x14</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x29</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line"></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xE1</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x70</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x07</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x08</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x08</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x04</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x46</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x18</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2B</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2D</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 18. 显示反相（Display Inversion On），让颜色更鲜亮，防止残影</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x21</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 19. 开启显示（Display On）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x29</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="LCD设置显示窗口-行列地址"><a href="#LCD设置显示窗口-行列地址" class="headerlink" title="LCD设置显示窗口(行列地址)"></a>LCD设置显示窗口(行列地址)</h3><h4 id="显示流程"><a href="#显示流程" class="headerlink" title="显示流程"></a>显示流程</h4><p>想让LCD上的每个像素显示出来，我们首先得告诉LCD我们想要显示的区域是哪里：xy的起始和终止坐标</p>
<p>所以我们在写入像素点数据之前，需要先<code>设置显示的行列地址</code></p>
<p><code>流程图</code>:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726171606593.png" alt="image-20250726171606593"></p>
<h4 id="列地址"><a href="#列地址" class="headerlink" title="列地址"></a>列地址</h4><p>列地址设置命令<code>CASET(0x2A)</code>，用于告诉LCD接下来要在哪些<code>列范围</code>写入数据</p>
<p>XS[15:0]: 16bit的<code>起始水平</code>坐标x</p>
<p>XE[15:0]: 16bit的<code>结束水平</code>坐标x</p>
<p>取值范围：0 &lt; XS[15:0] &lt; XE[15:0] &lt; 239(00EF) MV &#x3D; “0”</p>
<p>取值范围：0 &lt; XS[15:0] &lt; XE[15:0] &lt; 319(013F) MV &#x3D; “1”</p>
<p>MV的值代表横竖屏两种的情况</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250726135425056.png" alt="image-20250726135425056"></p>
<p>四线SPI中不用管<code>WRX</code>和<code>RDX</code>（具体原因请见上方RDX、WRX、DCX）引脚的说明，只需要对<code>D/CX</code>引脚进行控制，然后发送数据即可</p>
<p>整个流程就是：</p>
<ol>
<li><p>拉低D&#x2F;CX引脚，然后发送命令0x2A</p>
</li>
<li><p>发送起始水平坐标x的高8bit</p>
</li>
<li><p>发送起始水平坐标x的低8bit</p>
</li>
<li><p>发送结束水平坐标x的高8bit</p>
</li>
<li><p>发送结束水平坐标x的低8bit</p>
</li>
</ol>
<h4 id="行地址"><a href="#行地址" class="headerlink" title="行地址"></a>行地址</h4><p>列地址设置命令<code>RASET(0x2B)</code>，用于告诉LCD接下来要在哪些<code>行范围</code>写入数据</p>
<p>YS[15:0]: 16bit的<code>起始垂直</code>坐标y</p>
<p>YE[15:0]: 16bit的<code>结束垂直</code>坐标y</p>
<p>取值范围：0 &lt; YS[15:0] &lt; YE[15:0] &lt; 239(00EF) MV &#x3D; “0”</p>
<p>取值范围：0 &lt; YS[15:0] &lt; YE[15:0] &lt; 319(013F) MV &#x3D; “1”</p>
<p>MV的值代表横竖屏两种的情况</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250727140752463.png" alt="image-20250727140752463"></p>
<p>四线SPI中不用管<code>WRX</code>和<code>RDX</code>（具体原因请见上方RDX、WRX、DCX）引脚的说明，只需要对<code>D/CX</code>引脚进行控制，然后发送数据即可</p>
<p>整个流程就是：</p>
<ol>
<li><p>拉低D&#x2F;CX引脚，然后发送命令0x2A</p>
</li>
<li><p>发送起始垂直坐标y的高8bit</p>
</li>
<li><p>发送起始垂直坐标y的低8bit</p>
</li>
<li><p>发送结束垂直坐标y的高8bit</p>
</li>
<li><p>发送结束垂直坐标y的低8bit</p>
</li>
</ol>
<h4 id="写显存"><a href="#写显存" class="headerlink" title="写显存"></a>写显存</h4><p><code>RAMWR(0x2C)</code>是写显存的命令，发送该命令后，芯片会等待接收显存数据了。</p>
<p>同时当这个命令被接受时，列寄存器和页寄存器被重置到设置的起始列&#x2F;起始页位置。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250727144443040.png" alt="image-20250727144443040"></p>
<h4 id="对应代码"><a href="#对应代码" class="headerlink" title="对应代码"></a>对应代码</h4><ul>
<li>设置行列地址+写显存命令</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief   设置LCD的显示窗口（起始和结束地址）</span></span><br><span class="line"><span class="comment"> * @param   x1 显示区域起始列地址</span></span><br><span class="line"><span class="comment"> * @param   y1 显示区域起始行地址</span></span><br><span class="line"><span class="comment"> * @param   x2 显示区域结束列地址</span></span><br><span class="line"><span class="comment"> * @param   y2 显示区域结束行地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note    本函数通过向LCD控制芯片发送命令和参数，设置后续像素数据写入的目标区域。</span></span><br><span class="line"><span class="comment"> *          只有设置好显示窗口后，才能高效地在指定区域进行图像、文字等内容的刷新操作。</span></span><br><span class="line"><span class="comment"> *          常用于绘制图形、局部刷新等场景，提升LCD操作效率。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Address_Set</span><span class="params">(u16 x1,u16 y1,u16 x2,u16 y2)</span></span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x2A</span>); <span class="comment">// CASET命令</span></span><br><span class="line">	LCD_Write_Data8(x1 &gt;&gt; <span class="number">8</span>); <span class="comment">// XS高字节</span></span><br><span class="line">	LCD_Write_Data8(x1 &amp; <span class="number">0xFF</span>); <span class="comment">// XS低字节</span></span><br><span class="line">	LCD_Write_Data8(x2 &gt;&gt; <span class="number">8</span>); <span class="comment">// XE高字节</span></span><br><span class="line">	LCD_Write_Data8(x2 &amp; <span class="number">0xFF</span>); <span class="comment">// XE低字节</span></span><br><span class="line">	</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x2B</span>); <span class="comment">// RASET命令</span></span><br><span class="line">	LCD_Write_Data8(y1 &gt;&gt; <span class="number">8</span>); <span class="comment">// YS高字节</span></span><br><span class="line">	LCD_Write_Data8(y1 &amp; <span class="number">0xFF</span>); <span class="comment">// YS低字节</span></span><br><span class="line">	LCD_Write_Data8(y2 &gt;&gt; <span class="number">8</span>); <span class="comment">// YE高字节</span></span><br><span class="line">	LCD_Write_Data8(y2 &amp; <span class="number">0xFF</span>); <span class="comment">// YE低字节</span></span><br><span class="line">	</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x2C</span>); <span class="comment">// 发送该命令，LCD开始等待接收显存数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="低功耗相关"><a href="#低功耗相关" class="headerlink" title="低功耗相关"></a>低功耗相关</h3><p>直接按照手册发送命令即可，分别对应<code>进入睡眠</code>和<code>退出睡眠</code>模式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250808190608876.png" alt="image-20250808190608876"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250808190628808.png" alt="image-20250808190628808"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* LCD退出睡眠  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepOut</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x10</span>);</span><br><span class="line">	delay_ms(<span class="number">100</span>); <span class="comment">//手册要求至少延时5ms</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD进入睡眠 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepIn</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x11</span>);</span><br><span class="line">	delay_ms(<span class="number">100</span>); <span class="comment">//手册要求至少延时5ms</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h3><p>还可以放一些其他于LCD相关的，比如我的项目中使用了SPI切换数据宽度，所以就放在这里了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LCD_SPI_SetBit</span><span class="params">(u8 bit)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(bit == <span class="number">8</span>)</span><br><span class="line">		&#123;</span><br><span class="line">        hspi1.Init.DataSize = SPI_DATASIZE_8BIT;</span><br><span class="line">				hspi1.Instance-&gt;CR1&amp;=~SPI_CR1_DFF;</span><br><span class="line">		&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit == <span class="number">16</span>)</span><br><span class="line">		&#123;		</span><br><span class="line">			  hspi1.Init.DataSize = SPI_DATASIZE_16BIT;</span><br><span class="line">				hspi1.Instance-&gt;CR1|=SPI_CR1_DFF;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="源文件"><a href="#源文件" class="headerlink" title="源文件"></a>源文件</h3><p>总结以上实现得到的源文件<code>lcd_st7789.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd_st7789.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 我们这里使用硬件SPI，其他的CS/DC/RST引脚使用软件模拟*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LCD_GPIO_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">		GPIO_InitTypeDef  GPIO_InitStructure = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		</span><br><span class="line">		__HAL_RCC_GPIOB_CLK_ENABLE();</span><br><span class="line">		</span><br><span class="line">		GPIO_InitStructure.Pin = LCD_CS_PIN | LCD_DC_PIN | LCD_RST_PIN;</span><br><span class="line">		GPIO_InitStructure.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">		GPIO_InitStructure.Pull = GPIO_PULLUP;</span><br><span class="line">		GPIO_InitStructure.Speed = GPIO_SPEED_FREQ_HIGH; <span class="comment">// 50MHz即可</span></span><br><span class="line">		HAL_GPIO_Init(GPIOB,&amp;GPIO_InitStructure);</span><br><span class="line">		</span><br><span class="line">		HAL_GPIO_WritePin(GPIOB, LCD_CS_PIN | LCD_DC_PIN | LCD_RST_PIN, GPIO_PIN_SET); <span class="comment">//默认拉高</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_SPI_SetBit</span><span class="params">(u8 bit)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(bit == <span class="number">8</span>)</span><br><span class="line">		&#123;</span><br><span class="line">        hspi1.Init.DataSize = SPI_DATASIZE_8BIT;</span><br><span class="line">				hspi1.Instance-&gt;CR1&amp;=~SPI_CR1_DFF;</span><br><span class="line">		&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit == <span class="number">16</span>)</span><br><span class="line">		&#123;		</span><br><span class="line">			  hspi1.Init.DataSize = SPI_DATASIZE_16BIT;</span><br><span class="line">				hspi1.Instance-&gt;CR1|=SPI_CR1_DFF;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 硬件SPI向ST7789发送一个字节*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LCD_Write_Byte</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="comment">//hardware spi</span></span><br><span class="line">		HAL_SPI_Transmit(&amp;hspi1,&amp;data,<span class="number">1</span>,HAL_MAX_DELAY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 软件spi*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">LCD_Write_Byte_Soft</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="comment">//software spi</span></span><br><span class="line">	  <span class="keyword">for</span>(<span class="type">uint8_t</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">				LCD_SCLK_LOW();</span><br><span class="line">			  <span class="keyword">if</span>( data &amp; (<span class="number">0x80</span> &gt;&gt; i))</span><br><span class="line">					LCD_MOSI_HIGH();</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					LCD_MOSI_LOW();</span><br><span class="line">				</span><br><span class="line">				LCD_SCLK_HIGH();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD向ST7789写命令*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Cmd</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_DC_LOW(); <span class="comment">// 切换为写命令</span></span><br><span class="line">	LCD_Write_Byte(data);</span><br><span class="line">	LCD_DC_HIGH(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*LCD向ST7789写8bit数据*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data8</span><span class="params">(u8 data)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_DC_HIGH(); <span class="comment">// 切换为写数据</span></span><br><span class="line">	LCD_Write_Byte(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*LCD向ST7789写16bit数据*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Write_Data16</span><span class="params">(u16 data)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_DC_HIGH();</span><br><span class="line">	LCD_Write_Byte(data &gt;&gt; <span class="number">8</span>);</span><br><span class="line">	LCD_Write_Byte(data &amp; <span class="number">0xFF</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief   设置LCD的显示窗口（起始和结束地址）</span></span><br><span class="line"><span class="comment"> * @param   x1 显示区域起始列地址</span></span><br><span class="line"><span class="comment"> * @param   y1 显示区域起始行地址</span></span><br><span class="line"><span class="comment"> * @param   x2 显示区域结束列地址</span></span><br><span class="line"><span class="comment"> * @param   y2 显示区域结束行地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note    本函数通过向LCD控制芯片发送命令和参数，设置后续像素数据写入的目标区域。</span></span><br><span class="line"><span class="comment"> *          只有设置好显示窗口后，才能高效地在指定区域进行图像、文字等内容的刷新操作。</span></span><br><span class="line"><span class="comment"> *          常用于绘制图形、局部刷新等场景，提升LCD操作效率。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Address_Set</span><span class="params">(u16 x1,u16 y1,u16 x2,u16 y2)</span></span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x2A</span>); <span class="comment">// CASET命令</span></span><br><span class="line">	LCD_Write_Data8(x1 &gt;&gt; <span class="number">8</span>); <span class="comment">// XS高字节</span></span><br><span class="line">	LCD_Write_Data8(x1 &amp; <span class="number">0xFF</span>); <span class="comment">// XS低字节</span></span><br><span class="line">	LCD_Write_Data8(x2 &gt;&gt; <span class="number">8</span>); <span class="comment">// XE高字节</span></span><br><span class="line">	LCD_Write_Data8(x2 &amp; <span class="number">0xFF</span>); <span class="comment">// XE低字节</span></span><br><span class="line">	</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x2B</span>); <span class="comment">// RASET命令</span></span><br><span class="line">	LCD_Write_Data8(y1 &gt;&gt; <span class="number">8</span>); <span class="comment">// YS高字节</span></span><br><span class="line">	LCD_Write_Data8(y1 &amp; <span class="number">0xFF</span>); <span class="comment">// YS低字节</span></span><br><span class="line">	LCD_Write_Data8(y2 &gt;&gt; <span class="number">8</span>); <span class="comment">// YE高字节</span></span><br><span class="line">	LCD_Write_Data8(y2 &amp; <span class="number">0xFF</span>); <span class="comment">// YE低字节</span></span><br><span class="line">	</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x2C</span>); <span class="comment">// 发送该命令，LCD开始等待接收显存数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD退出睡眠  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepOut</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x10</span>);</span><br><span class="line">	delay_ms(<span class="number">100</span>); <span class="comment">//手册要求至少延时5ms</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD进入睡眠 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_ST7789_SleepIn</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_Write_Cmd(<span class="number">0x11</span>);</span><br><span class="line">	delay_ms(<span class="number">100</span>); <span class="comment">//手册要求至少延时5ms</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_GPIO_Init();</span><br><span class="line">	LCD_CS_LOW();		<span class="comment">//chip select</span></span><br><span class="line">	</span><br><span class="line">	LCD_RST_LOW(); <span class="comment">//复位芯片</span></span><br><span class="line">	delay_ms(<span class="number">100</span>);</span><br><span class="line">	LCD_RST_HIGH();</span><br><span class="line">	delay_ms(<span class="number">100</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*开始初始化序列*/</span></span><br><span class="line"> <span class="comment">//************* Start Initial Sequence **********//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 退出睡眠模式，唤醒LCD</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x11</span>);   <span class="comment">// Sleep Out（唤醒命令）</span></span><br><span class="line">    delay_ms(<span class="number">120</span>);      <span class="comment">// 等待120ms，确保芯片完全唤醒（手册要求）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 设置 Porch 参数（显示驱动时的帧间隔、同步等，影响稳定性）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xB2</span>);   <span class="comment">// Porch Setting</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>); <span class="comment">// 前 Porch</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>); <span class="comment">// 后 Porch</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x00</span>); <span class="comment">// 间隔时间</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>); <span class="comment">// 帧间隔/时序</span></span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>); <span class="comment">// 帧间隔/时序</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 开启撕裂信号（Tearing Effect Line），通常用于同步显示，0表示关闭</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x35</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x00</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 设置内存访问控制（MADCTL），决定屏幕的扫描方向和RGB排列</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x36</span>);   </span><br><span class="line">    <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">0</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0x00</span>); <span class="comment">// 竖屏，正常方向</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">1</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0xC0</span>); <span class="comment">// 横屏，水平翻转</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (USE_HORIZONTAL == <span class="number">2</span>)</span><br><span class="line">        LCD_Write_Data8(<span class="number">0x70</span>); <span class="comment">// 竖屏，垂直翻转</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        LCD_Write_Data8(<span class="number">0xA0</span>); <span class="comment">// 横屏，其他方向</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 设置像素格式（COLMOD），0x05表示16位色(RGB565)</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x3A</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x05</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 设置门极驱动控制（Gate Control），影响扫描驱动电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xB7</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x35</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. 设置VCOM电压，影响对比度和显示质量</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xBB</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2D</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10. 设置电源控制（Power Control 1），调节显示驱动电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2C</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11. 设置电源控制（Power Control 2），调节内部偏置</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC2</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x01</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12. 设置电源控制（Power Control 3），进一步调节电压参数</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC3</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 13. 设置电源控制（Power Control 4），进一步调节电压参数</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC4</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 14. 设置驱动控制（VDV and VRH Command Enable），影响帧速率和电压</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xC6</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0F</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15. 设置正向电压控制（Positive Voltage Gamma Control）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xD0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA4</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 16. 设置负向电压控制（Negative Voltage Gamma Control）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xD6</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0xA1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 17. 设置Gamma校准参数（影响色彩表现和灰阶显示）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xE0</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x70</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x05</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0A</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0B</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0A</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x27</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x44</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x47</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x37</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x14</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x14</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x29</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line"></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0xE1</span>);   </span><br><span class="line">    LCD_Write_Data8(<span class="number">0x70</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x07</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x0C</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x08</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x08</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x04</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2F</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x33</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x46</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x18</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x15</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2B</span>);</span><br><span class="line">    LCD_Write_Data8(<span class="number">0x2D</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 18. 显示反相（Display Inversion On），让颜色更鲜亮，防止残影</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x21</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 19. 开启显示（Display On）</span></span><br><span class="line">    LCD_Write_Cmd(<span class="number">0x29</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="LCD显示开发"><a href="#LCD显示开发" class="headerlink" title="LCD显示开发"></a>LCD显示开发</h2><h3 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h3><p>我们底层已经写好了，这里就可以进行编写一些LCD显示相关的函数了</p>
<h3 id="头文件-1"><a href="#头文件-1" class="headerlink" title="头文件"></a>头文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LCD_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LCD_H_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*底层驱动文件*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd_st7789.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*LCD绘制相关*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill</span><span class="params">(u16 xsta,u16 ysta,u16 xend,u16 yend,u16 color)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill_DMA</span><span class="params">(u16 x_start,u16 y_start,u16 x_end,u16 y_end,u16* color)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ..... 包括画图形(点、线、图形)、显示汉字/字符/整数、图片等定义，参考厂家代码设计</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 背光相关设置 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Set_Light</span><span class="params">(<span class="type">uint8_t</span> duty)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Open_BackLight</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Close_BackLight</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 每个16bit像素对应的颜色数据*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WHITE         	 0xFFFF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLACK         	 0x0000	  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLUE           	 0x001F  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BRED             0XF81F</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRED 			       0XFFE0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GBLUE			       0X07FF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RED           	 0xF800</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAGENTA       	 0xF81F</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GREEN         	 0x07E0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CYAN          	 0x7FFF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> YELLOW        	 0xFFE0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BROWN 			     0XBC40 <span class="comment">//棕色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BRRED 			     0XFC07 <span class="comment">//棕红色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRAY  			     0X8430 <span class="comment">//灰色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DARKBLUE      	 0X01CF	<span class="comment">//深蓝色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIGHTBLUE      	 0X7D7C	<span class="comment">//浅蓝色  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRAYBLUE       	 0X5458 <span class="comment">//灰蓝色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIGHTGREEN     	 0X841F <span class="comment">//浅绿色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LGRAY 			     0XC618 <span class="comment">//浅灰色(PANNEL),窗体背景色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LGRAYBLUE        0XA651 <span class="comment">//浅灰蓝色(中间层颜色)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LBBLUE           0X2B12 <span class="comment">//浅棕蓝色(选择条目的反色)</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>



<p>下面分别介绍头文件内容：</p>
<p><code>函数声明</code>： 主要对我们进行实际LCD显示的一些API，供应用层使用，包括区域填充，画图形，显示汉字&#x2F;字符&#x2F;数字等。</p>
<p>还有涉及到<code>背光</code>的需要我们开启背光LCD才能显示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*LCD绘制相关*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill</span><span class="params">(u16 xsta,u16 ysta,u16 xend,u16 yend,u16 color)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill_DMA</span><span class="params">(u16 x_start,u16 y_start,u16 x_end,u16 y_end,u16* color)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ..... 包括画图形(点、线、图形)、显示汉字/字符/整数、图片等定义，参考厂家代码设计</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_DrawPoint</span><span class="params">(u16 x,u16 y,u16 color)</span>;<span class="comment">//在指定位置画一个点 </span></span><br><span class="line"><span class="comment">//....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 背光相关设置 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Set_Light</span><span class="params">(<span class="type">uint8_t</span> duty)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Open_BackLight</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Close_BackLight</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>



<p><code>宏定义</code>：我们底层使用的是RGB565的格式，每个像素16bit显示不同颜色，我们需要提前定义好对应颜色的数据，以便于应用层可以直接指定想要填充的颜色</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 每个16bit像素对应的颜色数据*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WHITE         	 0xFFFF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLACK         	 0x0000	  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLUE           	 0x001F  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BRED             0XF81F</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRED 			       0XFFE0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GBLUE			       0X07FF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RED           	 0xF800</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAGENTA       	 0xF81F</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GREEN         	 0x07E0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CYAN          	 0x7FFF</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> YELLOW        	 0xFFE0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BROWN 			     0XBC40 <span class="comment">//棕色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BRRED 			     0XFC07 <span class="comment">//棕红色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRAY  			     0X8430 <span class="comment">//灰色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DARKBLUE      	 0X01CF	<span class="comment">//深蓝色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIGHTBLUE      	 0X7D7C	<span class="comment">//浅蓝色  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GRAYBLUE       	 0X5458 <span class="comment">//灰蓝色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIGHTGREEN     	 0X841F <span class="comment">//浅绿色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LGRAY 			     0XC618 <span class="comment">//浅灰色(PANNEL),窗体背景色</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LGRAYBLUE        0XA651 <span class="comment">//浅灰蓝色(中间层颜色)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LBBLUE           0X2B12 <span class="comment">//浅棕蓝色(选择条目的反色)</span></span></span><br></pre></td></tr></table></figure>





<h3 id="背光"><a href="#背光" class="headerlink" title="背光"></a>背光</h3><p>这里我们使用PWM对背光引脚进行输出，可以控制屏幕的亮度</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*设置LCD背光源亮度*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Set_Light</span><span class="params">(<span class="type">uint8_t</span> duty)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(duty &gt;=<span class="number">5</span> &amp;&amp; duty &lt;=<span class="number">100</span>)</span><br><span class="line">	__HAL_TIM_SetCompare(&amp;htim3,TIM_CHANNEL_3,duty*<span class="number">320</span>/<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*开启LCD背光*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Open_BackLight</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_TIM_PWM_Start(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*关闭LCD背光*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Close_BackLight</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_TIM_PWM_Stop(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="LCD显示开发-1"><a href="#LCD显示开发-1" class="headerlink" title="LCD显示开发"></a>LCD显示开发</h3><h4 id="填充区域"><a href="#填充区域" class="headerlink" title="填充区域"></a>填充区域</h4><p>写好LCD底层后，我们想要对应区域显示我们指定的颜色，需要以下步骤：</p>
<ol>
<li>设置显示行列地址</li>
<li>写入像素数据</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill</span><span class="params">(u16 xsta,u16 ysta,u16 xend,u16 yend,u16 color)</span></span><br><span class="line">&#123;          </span><br><span class="line">	u16 i,j; </span><br><span class="line">        <span class="comment">/* 1. 设置显示范围*/</span></span><br><span class="line">	LCD_Address_Set(xsta,ysta,xend<span class="number">-1</span>,yend<span class="number">-1</span>);</span><br><span class="line">    </span><br><span class="line">   	 <span class="comment">/* 2. 写入对应的像素数据RGB565 */</span></span><br><span class="line">	<span class="keyword">for</span>(i=ysta;i&lt;yend;i++)</span><br><span class="line">	&#123;		</span><br><span class="line">		<span class="keyword">for</span>(j=xsta;j&lt;xend;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			LCD_Write_Data16(color); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125; 					  	    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面就是最基本的显示方法了，但是我们通常都是使用DMA的方式批量写入数据：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill_DMA</span><span class="params">(u16 x_start,u16 y_start,u16 x_end,u16 y_end,u16* color)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	u16 width,height;</span><br><span class="line">	u32 size;</span><br><span class="line">	width = x_end-x_start+<span class="number">1</span>;</span><br><span class="line">	height = y_end-y_start+<span class="number">1</span>;</span><br><span class="line">	size = width * height; <span class="comment">// 区域总像素个数</span></span><br><span class="line">	</span><br><span class="line">	LCD_Address_Set(x_start,y_start+OFFSET_Y,x_end,y_end+OFFSET_Y);</span><br><span class="line">  LCD_SPI_SetBit(<span class="number">16</span>);</span><br><span class="line">	</span><br><span class="line">	HAL_SPI_Transmit_DMA(&amp;hspi1,(<span class="type">uint8_t</span>*)color,size); <span class="comment">// 每个像素16bit</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="画图形"><a href="#画图形" class="headerlink" title="画图形"></a>画图形</h4><h4 id="显示字符-数字等"><a href="#显示字符-数字等" class="headerlink" title="显示字符&#x2F;数字等"></a>显示字符&#x2F;数字等</h4><h4 id="显示图像"><a href="#显示图像" class="headerlink" title="显示图像"></a>显示图像</h4><h3 id="源文件-1"><a href="#源文件-1" class="headerlink" title="源文件"></a>源文件</h3><p>最终得到的<code>lcd.c</code>文件如下:</p>
<p>唯一注意的就是，我们需要根据实际情况，实际测试时应该需要<code>校准</code>：添加一个偏移量到我们的xy坐标，时显示区域覆盖完我们的LCD屏幕</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lv_port_disp.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OFFSET_Y 20 <span class="comment">//显示区域为x:0~239 y:20~299</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OFFSET_X 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">lv_display_t</span> * disp; <span class="comment">// lvgl显示对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill</span><span class="params">(u16 x_start,u16 y_start,u16 x_end,u16 y_end,u16 color)</span></span><br><span class="line">&#123;          </span><br><span class="line">	u16 i,j; </span><br><span class="line">	LCD_Address_Set(x_start,y_start+OFFSET_Y,x_end<span class="number">-1</span>,y_end+OFFSET_Y<span class="number">-1</span>);<span class="comment">//设置显示范围</span></span><br><span class="line">	<span class="keyword">for</span>(i=y_start;i&lt;y_end;i++)</span><br><span class="line">	&#123;		</span><br><span class="line">		<span class="keyword">for</span>(j=x_start;j&lt;x_end;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			LCD_Write_Data16(color);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; 					  	    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill_DMA</span><span class="params">(u16 x_start,u16 y_start,u16 x_end,u16 y_end,u16* color)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	u16 width,height;</span><br><span class="line">	u32 size;</span><br><span class="line">	width = x_end-x_start+<span class="number">1</span>;</span><br><span class="line">	height = y_end-y_start+<span class="number">1</span>;</span><br><span class="line">	size = width * height; <span class="comment">// 区域总像素个数</span></span><br><span class="line">	</span><br><span class="line">	LCD_Address_Set(x_start,y_start+OFFSET_Y,x_end,y_end+OFFSET_Y);</span><br><span class="line">  LCD_SPI_SetBit(<span class="number">16</span>);</span><br><span class="line">	</span><br><span class="line">	HAL_SPI_Transmit_DMA(&amp;hspi1,(<span class="type">uint8_t</span>*)color,size); <span class="comment">// 每个像素16bit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*设置LCD背光源亮度*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Set_Light</span><span class="params">(<span class="type">uint8_t</span> duty)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(duty &gt;=<span class="number">5</span> &amp;&amp; duty &lt;=<span class="number">100</span>)</span><br><span class="line">	__HAL_TIM_SetCompare(&amp;htim3,TIM_CHANNEL_3,duty*<span class="number">320</span>/<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*开启LCD背光*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Open_BackLight</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_TIM_PWM_Start(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*关闭LCD背光*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Close_BackLight</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HAL_TIM_PWM_Stop(&amp;htim3,TIM_CHANNEL_3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_SPI_TxCpltCallback</span><span class="params">(SPI_HandleTypeDef *hspi)</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="keyword">if</span>(hspi == &amp;hspi1)</span><br><span class="line">		&#123;</span><br><span class="line">				LCD_SPI_SetBit(<span class="number">8</span>);</span><br><span class="line">			  lv_display_flush_ready(disp);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 其余部分是厂家给的画点、画线等等LCD的驱动，我这里不使用就不移植了*/</span></span><br></pre></td></tr></table></figure>





<h1 id="驱动测试代码编写"><a href="#驱动测试代码编写" class="headerlink" title="驱动测试代码编写"></a>驱动测试代码编写</h1><p>编写完驱动之后，我们通常会写一些参考示例测试我们的驱动，同时后续以供别人使用</p>
<h2 id="填充测试"><a href="#填充测试" class="headerlink" title="填充测试"></a>填充测试</h2><p>这个是最基本的测试，可以测试我们驱动是否有问题</p>
<p>驱动编写完成之后我们就可以开始测试了：</p>
<p>1.初始化LCD，开启LCD背光</p>
<p>2.LCD填充</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../assets/image-20250808182830530.png" alt="image-20250808182830530"></p>
<p>最终看屏幕有没有正常显示颜色，正常显示代表成功。</p>
<p>否则可能是<code>通讯协议</code>、<code>数据格式</code>、<code>偏移量</code>的问题，建议依次排查</p>
<h2 id="其他测试"><a href="#其他测试" class="headerlink" title="其他测试"></a>其他测试</h2><p>然后可以进行一些其他的点、线、图片测试等</p>
<h1 id="LCD开发时可能的问题"><a href="#LCD开发时可能的问题" class="headerlink" title="LCD开发时可能的问题"></a>LCD开发时可能的问题</h1><h2 id="花屏"><a href="#花屏" class="headerlink" title="花屏"></a>花屏</h2><p><strong>问题1</strong>：调用填充LCD函数<code>LCD_Fill(0,20,240, 280, 0xFFFF)</code>时，部分行花屏</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill</span><span class="params">(u16 xsta,u16 ysta,u16 xend,u16 yend,u16 color)</span></span><br><span class="line">&#123;          </span><br><span class="line">	u16 i,j; </span><br><span class="line">	LCD_Address_Set(xsta,ysta,xend<span class="number">-1</span>,yend<span class="number">-1</span>);<span class="comment">//设置显示范围</span></span><br><span class="line">	<span class="keyword">for</span>(i=ysta;i&lt;yend;i++)</span><br><span class="line">	&#123;		</span><br><span class="line">		<span class="keyword">for</span>(j=xsta;j&lt;xend;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			LCD_WR_DATA(color);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; 					  	    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>原因</strong>：使用ST7789V可操纵240×320的分辨率，而买到的P169H002-CTP屏幕是240×280，显示坐标不一定是从0开始<code>x:0-240</code>，<code>y:0-280</code>，我们需要自己添加偏移量找到显示位置</p>
<p>最终尝试后发现需要在y轴添加20的偏移量后屏幕显示正常，所以该屏幕的实际显示坐标为 <code>x: 0-240</code>，<code>y: 20-300</code>，对应的分辨率也满足240×280</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> OFFSET_Y 20</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Fill</span><span class="params">(u16 xsta,u16 ysta,u16 xend,u16 yend,u16 color)</span></span><br><span class="line">&#123;          </span><br><span class="line">	u16 i,j; </span><br><span class="line">	LCD_Address_Set(xsta,ysta+OFFSET_Y,xend<span class="number">-1</span>,yend<span class="number">-1</span>+OFFSET_Y);<span class="comment">//设置显示范围</span></span><br><span class="line">	<span class="keyword">for</span>(i=ysta;i&lt;yend;i++)</span><br><span class="line">	&#123;		</span><br><span class="line">		<span class="keyword">for</span>(j=xsta;j&lt;xend;j++)</span><br><span class="line">		&#123;</span><br><span class="line">			LCD_WR_DATA(color);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; 					  	    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i.postimg.cc/fbN6bFqP/20220206101541-14a48.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i.postimg.cc/fbN6bFqP/20220206101541-14a48.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">THEDI</div><div class="post-copyright__author_desc">我想睡到12点!</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/')">LCD显示屏开发</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=LCD显示屏开发&amp;url=https://www.thekqd.top/2025/08/29/LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%BC%80%E5%8F%91/&amp;pic=/assets/213.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.thekqd.top" target="_blank">THEDI的仓库</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/LCD/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>LCD<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/assets/213.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/08/29/LCD%E8%A7%A6%E6%91%B8%E5%B1%8F%E5%BC%80%E5%8F%91/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/36.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">LCD触摸屏开发</div></div></a></div><div class="next-post pull-right"><a href="/2025/08/29/%E8%BD%AF%E4%BB%B6I2C%E7%9A%84%E5%BC%95%E8%84%9A%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/98.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">软件I2C的引脚配置问题</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/08/29/LCD%E8%A7%A6%E6%91%B8%E5%B1%8F%E5%BC%80%E5%8F%91/" title="LCD触摸屏开发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/36.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-29</div><div class="title">LCD触摸屏开发</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i.postimg.cc/fbN6bFqP/20220206101541-14a48.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">THEDI</h1><div class="author-info__desc">我想睡到12点!</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/assets/QRCode.jpg" target="_blank" title="微信"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-weixin"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/" target="_blank" title="B站"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a><a class="social-icon faa-parent animated-hover" href="mailto:1244381125@qq.com" target="_blank" title="QQ邮箱"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">不要偷看我的博客!</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(null) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#LCD%E6%98%BE%E7%A4%BA%E5%B1%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">LCD显示屏介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFLCD"><span class="toc-number">1.1.</span> <span class="toc-text">什么是LCD?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">LCD基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E6%98%BE%E7%A4%BA%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">LCD显示原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%B1%8F%E5%B9%95%E5%9E%8B%E5%8F%B7"><span class="toc-number">1.4.</span> <span class="toc-text">常见屏幕型号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8BLCD%EF%BC%88Character-LCD%EF%BC%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">字符型LCD（Character LCD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AE%B5%E7%A0%81%E5%B1%8F%EF%BC%88Segment-LCD%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">段码屏（Segment LCD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%82%B9%E9%98%B5LCD%EF%BC%88Graphic-LCD%EF%BC%89"><span class="toc-number">1.4.3.</span> <span class="toc-text">图形点阵LCD（Graphic LCD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TFT%E5%BD%A9%E8%89%B2LCD%EF%BC%88TFT-LCD%EF%BC%89"><span class="toc-number">1.4.4.</span> <span class="toc-text">TFT彩色LCD（TFT LCD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPS%E5%AE%BD%E8%A7%86%E8%A7%92LCD%EF%BC%88IPS-LCD%EF%BC%89"><span class="toc-number">1.4.5.</span> <span class="toc-text">IPS宽视角LCD（IPS LCD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OLED%E6%98%BE%E7%A4%BA%E5%B1%8F-%E9%9D%9ELCD"><span class="toc-number">1.4.6.</span> <span class="toc-text">OLED显示屏(非LCD)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB%E6%80%BB%E7%BB%93"><span class="toc-number">1.4.7.</span> <span class="toc-text">主要区别总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LCD%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%A7%A3%E8%AF%BB"><span class="toc-number">2.</span> <span class="toc-text">LCD开发手册解读</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%82%E5%AE%B6%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.</span> <span class="toc-text">厂家代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%8F%E5%B9%95%E6%89%8B%E5%86%8C"><span class="toc-number">2.2.</span> <span class="toc-text">屏幕手册</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.2.1.</span> <span class="toc-text">总体描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E8%84%9A%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">引脚描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E6%B0%94%E7%89%B9%E6%80%A7"><span class="toc-number">2.2.3.</span> <span class="toc-text">电气特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ST7789"><span class="toc-number">2.3.</span> <span class="toc-text">ST7789</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ST7789%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.3.1.</span> <span class="toc-text">ST7789介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%86%8C%E9%98%85%E8%AF%BB"><span class="toc-number">2.3.2.</span> <span class="toc-text">手册阅读</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">特征介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%BC%95%E8%84%9A%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">全引脚介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">通信接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E5%BC%95%E8%84%9A%E5%AE%9A%E4%B9%89"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">通信引脚定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDX%E3%80%81WRX%E3%80%81DCX%E8%AF%B4%E6%98%8E"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">RDX、WRX、DCX说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.6.</span> <span class="toc-text">写命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.2.6.1.</span> <span class="toc-text">数据格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F"><span class="toc-number">2.3.2.6.2.</span> <span class="toc-text">时序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.2.7.</span> <span class="toc-text">读数据</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LCD%E6%98%BE%E7%A4%BA%E5%BC%80%E5%8F%91%E6%97%B6%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">3.</span> <span class="toc-text">LCD显示开发时相关知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E8%83%8C%E5%85%89%E6%BA%90-Back-Light"><span class="toc-number">3.1.</span> <span class="toc-text">LCD背光源(Back Light)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%85%89%E5%B1%82%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">背光层介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%85%89%E5%BC%95%E8%84%9A"><span class="toc-number">3.1.2.</span> <span class="toc-text">背光引脚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%85%89%E5%BC%95%E8%84%9A%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">背光引脚的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6PWM%E8%B0%83%E5%85%89"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">硬件PWM调光</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E5%85%89%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.3.1.1.</span> <span class="toc-text">调光介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8PWM%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.1.3.1.2.</span> <span class="toc-text">使用PWM注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%85%89%E5%BC%95%E8%84%9A%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.4.</span> <span class="toc-text">背光引脚代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E8%84%9A%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">引脚配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">驱动代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E5%83%8F%E7%B4%A0%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">LCD像素格式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%8F%E7%B4%A0%E6%A0%BC%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.2.1.</span> <span class="toc-text">像素格式介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LCD%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">LCD使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">LCD初始化代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%AALCD%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A3%E7%A0%81%EF%BC%9F"><span class="toc-number">3.3.1.</span> <span class="toc-text">为什么要有这个LCD初始化代码？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.3.2.</span> <span class="toc-text">初始化代码示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%BC%80%E5%8F%91%E6%98%BE%E7%A4%BA%E9%A9%B1%E5%8A%A8"><span class="toc-number">4.</span> <span class="toc-text">从零开始开发显示驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%85%A5%E6%89%8B%E5%BC%80%E5%8F%91LCD"><span class="toc-number">4.1.</span> <span class="toc-text">如何入手开发LCD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E5%BA%95%E5%B1%82%E5%BC%80%E5%8F%91"><span class="toc-number">4.3.</span> <span class="toc-text">LCD底层开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">4.3.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.2.</span> <span class="toc-text">头文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E8%84%9A%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">4.3.3.</span> <span class="toc-text">引脚初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E5%86%99%E6%95%B0%E6%8D%AE"><span class="toc-number">4.3.4.</span> <span class="toc-text">通讯协议写数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%AF%E7%89%87%E5%86%99%E5%91%BD%E4%BB%A4-%E6%95%B0%E6%8D%AE"><span class="toc-number">4.3.5.</span> <span class="toc-text">芯片写命令&#x2F;数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LCD%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">4.3.6.</span> <span class="toc-text">LCD初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LCD%E8%AE%BE%E7%BD%AE%E6%98%BE%E7%A4%BA%E7%AA%97%E5%8F%A3-%E8%A1%8C%E5%88%97%E5%9C%B0%E5%9D%80"><span class="toc-number">4.3.7.</span> <span class="toc-text">LCD设置显示窗口(行列地址)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%B5%81%E7%A8%8B"><span class="toc-number">4.3.7.1.</span> <span class="toc-text">显示流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E5%9C%B0%E5%9D%80"><span class="toc-number">4.3.7.2.</span> <span class="toc-text">列地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E5%9C%B0%E5%9D%80"><span class="toc-number">4.3.7.3.</span> <span class="toc-text">行地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%98%BE%E5%AD%98"><span class="toc-number">4.3.7.4.</span> <span class="toc-text">写显存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94%E4%BB%A3%E7%A0%81"><span class="toc-number">4.3.7.5.</span> <span class="toc-text">对应代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E5%8A%9F%E8%80%97%E7%9B%B8%E5%85%B3"><span class="toc-number">4.3.8.</span> <span class="toc-text">低功耗相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85"><span class="toc-number">4.3.9.</span> <span class="toc-text">其他补充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.10.</span> <span class="toc-text">源文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCD%E6%98%BE%E7%A4%BA%E5%BC%80%E5%8F%91"><span class="toc-number">4.4.</span> <span class="toc-text">LCD显示开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-1"><span class="toc-number">4.4.2.</span> <span class="toc-text">头文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%85%89"><span class="toc-number">4.4.3.</span> <span class="toc-text">背光</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LCD%E6%98%BE%E7%A4%BA%E5%BC%80%E5%8F%91-1"><span class="toc-number">4.4.4.</span> <span class="toc-text">LCD显示开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%85%85%E5%8C%BA%E5%9F%9F"><span class="toc-number">4.4.4.1.</span> <span class="toc-text">填充区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%BB%E5%9B%BE%E5%BD%A2"><span class="toc-number">4.4.4.2.</span> <span class="toc-text">画图形</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%AD%97%E7%AC%A6-%E6%95%B0%E5%AD%97%E7%AD%89"><span class="toc-number">4.4.4.3.</span> <span class="toc-text">显示字符&#x2F;数字等</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%83%8F"><span class="toc-number">4.4.4.4.</span> <span class="toc-text">显示图像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E6%96%87%E4%BB%B6-1"><span class="toc-number">4.4.5.</span> <span class="toc-text">源文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-number">5.</span> <span class="toc-text">驱动测试代码编写</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A1%AB%E5%85%85%E6%B5%8B%E8%AF%95"><span class="toc-number">5.1.</span> <span class="toc-text">填充测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B5%8B%E8%AF%95"><span class="toc-number">5.2.</span> <span class="toc-text">其他测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LCD%E5%BC%80%E5%8F%91%E6%97%B6%E5%8F%AF%E8%83%BD%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">6.</span> <span class="toc-text">LCD开发时可能的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%B1%E5%B1%8F"><span class="toc-number">6.1.</span> <span class="toc-text">花屏</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/30/MQTT%E8%BF%9E%E6%8E%A5AWS-IoT/" title="MQTT连接AWS IoT"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/213.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MQTT连接AWS IoT"/></a><div class="content"><a class="title" href="/2025/08/30/MQTT%E8%BF%9E%E6%8E%A5AWS-IoT/" title="MQTT连接AWS IoT">MQTT连接AWS IoT</a><time datetime="2025-08-29T16:33:21.000Z" title="发表于 2025-08-30 00:33:21">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/30/TLS%E4%BC%A0%E8%BE%93%E5%B1%82%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE/" title="TLS传输层安全协议"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/33.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TLS传输层安全协议"/></a><div class="content"><a class="title" href="/2025/08/30/TLS%E4%BC%A0%E8%BE%93%E5%B1%82%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE/" title="TLS传输层安全协议">TLS传输层安全协议</a><time datetime="2025-08-29T16:31:07.000Z" title="发表于 2025-08-30 00:31:07">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/30/AWS%E4%BB%8B%E7%BB%8D/" title="AWS介绍"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/28.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AWS介绍"/></a><div class="content"><a class="title" href="/2025/08/30/AWS%E4%BB%8B%E7%BB%8D/" title="AWS介绍">AWS介绍</a><time datetime="2025-08-29T16:28:11.000Z" title="发表于 2025-08-30 00:28:11">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/30/PCB%E8%AE%BE%E8%AE%A1-%E5%9F%BA%E4%BA%8E%E7%AB%8B%E5%88%9BEDA/" title="PCB设计(基于立创EDA)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/26.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PCB设计(基于立创EDA)"/></a><div class="content"><a class="title" href="/2025/08/30/PCB%E8%AE%BE%E8%AE%A1-%E5%9F%BA%E4%BA%8E%E7%AB%8B%E5%88%9BEDA/" title="PCB设计(基于立创EDA)">PCB设计(基于立创EDA)</a><time datetime="2025-08-29T16:20:05.000Z" title="发表于 2025-08-30 00:20:05">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/30/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" title="加密算法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/5.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="加密算法"/></a><div class="content"><a class="title" href="/2025/08/30/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" title="加密算法">加密算法</a><time datetime="2025-08-29T16:12:06.000Z" title="发表于 2025-08-30 00:12:06">2025-08-30</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="THEDI" target="_blank">THEDI</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">63</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="安知鱼的博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="安知鱼的博客"/><span class="back-menu-item-text">安知鱼的博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/keqiudi/keqiudi.github.io" title="我的博客仓库"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="我的博客仓库"/><span class="back-menu-item-text">我的博客仓库</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AWS/" style="font-size: 0.88rem;">AWS<sup>2</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>2</sup></a><a href="/tags/CLion/" style="font-size: 0.88rem;">CLion<sup>2</sup></a><a href="/tags/CMake/" style="font-size: 0.88rem;">CMake<sup>1</sup></a><a href="/tags/ESP32/" style="font-size: 0.88rem;">ESP32<sup>1</sup></a><a href="/tags/FreeRTOS/" style="font-size: 0.88rem;">FreeRTOS<sup>5</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/LCD/" style="font-size: 0.88rem;">LCD<sup>2</sup></a><a href="/tags/LVGL/" style="font-size: 0.88rem;">LVGL<sup>7</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>8</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>2</sup></a><a href="/tags/PCB/" style="font-size: 0.88rem;">PCB<sup>2</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/keil/" style="font-size: 0.88rem;">keil<sup>1</sup></a><a href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">云服务<sup>3</sup></a><a href="/tags/%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" style="font-size: 0.88rem;">启动流程<sup>2</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 0.88rem;">嵌入式<sup>2</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">嵌入式安全<sup>3</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">架构<sup>2</sup></a><a href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">环境配置<sup>4</sup></a><a href="/tags/%E7%A1%AC%E4%BB%B6/" style="font-size: 0.88rem;">硬件<sup>5</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>3</sup></a><a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size: 0.88rem;">调试<sup>5</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/01/2022 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2022 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 THEDI 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/01/2022 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="//at.alicdn.com/t/c/font_4169545_k8d3mxnig4s.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>